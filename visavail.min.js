(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.visavail=e()})(this,function(){function t(t,e){function a(t){var e={ddd:"a",dddd:"A",MMM:"b",MMMM:"B",lll:"c",DD:"d",D:"e","YYYY-MM-DD":"F",HH:"H",H:"H",hh:"I",h:"I",DDDD:"j",DDD:"-j",MM:"m",M:"-m",mm:"M",m:"-M",A:"p",a:"P",ss:"S",s:"-S",E:"u",d:"w",WW:"W",ll:"x",LTS:"X",YY:"y",YYYY:"Y",ZZ:"z",z:"Z",SSS:"L","%":"%"},a=t.split(/( |\/|:|,|\]|\[|\.)/),n=a.map(function(t){if(":"==t[0]||"/"==t[0]||" "==t[0]||","==t[0])return t;if("["!=t[0]&&"]"!=t[0])return e.hasOwnProperty(t)?"%"+e[t]:t.length>0?"["+t+"]":t}).join("");return n}function n(){return p.LTS.indexOf("a")>-1||p.LTS.indexOf("A")>-1}function r(t){return(o.timeSecond(t)<t?o.timeFormat(l.custom_time_format.format_millisecond):o.timeMinute(t)<t?o.timeFormat(l.custom_time_format.format_second):o.timeHour(t)<t?o.timeFormat(l.custom_time_format.format_minute):o.timeDay(t)<t?o.timeFormat(l.custom_time_format.format_hour):o.timeMonth(t)<t?o.timeWeek(t)<t?o.timeFormat(l.custom_time_format.format_day):o.timeFormat(l.custom_time_format.format_week):o.timeYear(t)<t?o.timeFormat(l.custom_time_format.format_month):o.timeFormat(l.custom_time_format.format_year))(t)}function i(t){t.each(function(e){function a(){for(var t=o.select(this),e=t.node().getComputedTextLength(),a=t.text();e>-1*l.padding.left+l.reduce_space_wrap&&a.length>0;)a=a.slice(0,-1),t.text(a+"..."),e=t.node().getComputedTextLength()}function n(t){A.select("#vGrid").selectAll("line.vert_grid").data(t.ticks(l.ticks_for_graph)).enter().append("line").attr("x1",function(e){return t(e)}).attr("x2",function(e){return t(e)}).attr("y1",0).attr("y2",l.graph.height*b+l.line_spacing*b-1+l.margin.bottom).attr("class","vert_grid")}function i(t){return+t===+new Date(t.getFullYear(),0,1,0,0,0)}function d(t){return+t===+new Date(t.getFullYear(),t.getMonth(),1,0,0,0)}function c(t){var e=t.ticks(l.ticks_for_graph),a=e.map(i),n=e.map(d);l.emphasize_year_ticks&&!a.every(function(t){return t===!0})&&n.every(function(t){return t===!0})&&(o.selectAll("#"+l.id_div_graph+" g.tick").each(function(t,e){a[e]&&o.select(this).attr("class","tick x_tick_emph")}),o.selectAll("#"+l.id_div_graph+" .vert_grid").each(function(t,e){a[e]&&o.select(this).attr("class","vert_grid vert_grid_emph")})),l.emphasize_month_ticks&&!n.every(function(t){return t===!0})&&(o.selectAll("#"+l.id_div_graph+" g.tick").each(function(t,e){n[e]&&o.select(this).attr("class","tick x_tick_emph")}),o.selectAll("#"+l.id_div_graph+" g.vert_grid").each(function(t,e){n[e]&&o.select(this).attr("class","vert_grid vert_grid_emph")}))}function p(){null==o.event.sourceEvent&&"zoom"!==o.event.type||(o.event.transform.k||o.event.transform.x)&&(l.xScale=o.event.transform.rescaleX(L),null!==o.event.sourceEvent&&"zoom"==o.event.type&&_.style("left",o.event.pageX+"px"),I.selectAll("rect").attr("x",function(t){return m(t,l.xScale)}).attr("width",function(t){return f(t,l.xScale)}).attr("transform",function(t){return g(t,l.xScale)}),A.select(".xAxis").call(T.scale(l.xScale)),A.select("#vGrid").selectAll("line").remove(),n(l.xScale),c(l.xScale),l.zoom.onZoom.call(this,l.xScale.domain()))}function m(t,e){var a=e(t[0]);return l.date_is_descending&&(a=e(t[2])),isNaN(a)||a<0||a>v?0:"rhombus"==l.graph.type||"circle"==l.graph.type?e(t[0])-l.graph.width/2:a}function f(t,e){var a=e(t[0]),n=e(t[2]);return l.date_is_descending&&(a=e(t[2]),n=e(t[0])),isNaN(a)||isNaN(n)||!l.date_is_descending&&n-a<0||n<0&&a<0?0:l.date_is_descending&&n-a<0?-1*(n-a):"rhombus"==l.graph.type||"circle"==l.graph.type?a<0?0:l.graph.width:a<0&&n>0?n>v?v:n:n<0&&a>0?a>v?v:a:n>v?v-a<0?0:v-a:n-a}function g(t,e){var a=e(t[0]);return("rhombus"==l.graph.type||"circle"==l.graph.type)&&a>0?"rotate(45 "+a+"  "+(l.graph.height/2+l.line_spacing)+")":("rhombus"==l.graph.type||"circle"==l.graph.type)&&a<=0?"rotate(45 0 "+(l.graph.height/2+l.line_spacing)+")":void 0}function u(){return"circle"==l.graph.type?2e5:0}o.timeFormatDefaultLocale(l.locale);var h,y,v=l.width-l.margin.left-l.margin.right,x=0;0!==l.max_display_datasets?(h=l.cur_display_first_dataset,y=l.cur_display_first_dataset+l.max_display_datasets>e.length?e.length:l.cur_display_first_dataset+l.max_display_datasets,x=Math.ceil(e.length/l.max_display_datasets)):(h=0,y=e.length),t.attr("data-max-pages",x);for(var b=y-h,w=l.graph.height*b+l.line_spacing*b-1,M=0;M<e.length;M++)if(e[M].description&&(l.tooltip.description=!0),null!=e[M].data[0]&&3==e[M].data[0].length){l.defined_blocks=!0,l.custom_categories||Number.isInteger(e[M].data[0][1])||(l.custom_categories=!0);break}if(l.date_in_utc)var D=function(t){return s.utc(t).toDate()},S=function(t){return s.utc(t).toDate()};else var D=function(t){return s(t).toDate()},S=function(t){return s(t).toDate()};var k=new RegExp(/^\d{4}-\d{2}-\d{2}$/),Y=new RegExp(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/);e.forEach(function(t){t.data.forEach(function(e){if(!(e[0]instanceof Date)){if(k.test(e[0]))e[0]=D(e[0]);else{if(!Y.test(e[0]))throw new Error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.");e[0]=S(e[0]),l.is_date_only_format=!1}l.defined_blocks?k.test(e[2])?e[2]=D(e[2]):Y.test(e[2])?e[2]=S(e[2]):(e[2]=e[0],"rhombus"!=l.graph.type&&console.error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.")):e[2]=o.timeSecond.offset(e[0],t.interval_s)}})});var E=s().year(2999),z=s().year(0);e.forEach(function(t,a){var n=[],r=t.data.length;t.data.forEach(function(t,e){s(t[2]).isSameOrAfter(z)&&(z=t[2]),s(t[0]).isSameOrBefore(E)&&(E=t[0]),0!==e&&e<r?t[1]===n[n.length-1][1]?l.defined_blocks?n[n.length-1][2].getTime()===t[0].getTime()?(n[n.length-1][2]=t[2],n[n.length-1][3]=t[1]):n.push(t):(n[n.length-1][2]=t[2],n[n.length-1][3]=t[1]):(l.defined_blocks||(n[n.length-1][2]=t[0]),n.push(t)):0===e&&(t[3]=t[1],n.push(t))}),e[a].disp_data=n}),0!=l.display_date_range[0]&&(E=s(l.display_date_range[0])),0!=l.display_date_range[1]&&(z=s(l.display_date_range[1]));var L=o.scaleTime().domain([E,z]).range([0,v]);l.date_is_descending&&L.domain([z,E]);var T=o.axisTop(L).scale(L).ticks(l.ticks_for_graph).tickFormat(r),A=o.select(this).append("svg").attr("width",v+l.margin.left+l.margin.right).attr("height",w+l.margin.top+l.margin.bottom).append("g").attr("transform","translate("+l.margin.left+","+l.margin.top+")");A.append("g").attr("id","g_title"),A.append("g").attr("id","g_axis"),l.zoom.enabled&&(l.zoomed=o.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[v,l.height]]).extent([[0,0],[v,l.height]]).on("zoom",p).on("start",function(){var t=o.event;t&&"brush"===t.type||(startEvent=t,l.zoom.onZoomStart.call(this,t))}).on("end",function(){var t=o.event.sourceEvent;t&&"brush"===t.type||t&&startEvent.clientX===t.clientX&&startEvent.clientY===t.clientY||(l.scale=o.zoomTransform(A.node()),l.zoom.onZoomEnd.call(this,L.domain()))}),A.append("rect").attr("id","zoom").attr("width",v).attr("height",w).attr("fill-opacity",0).attr("cursor","ew-resize").attr("x",0).attr("y",0),A.call(l.zoomed)),A.append("g").attr("id","g_data"),l.show_y_title&&(A.select("#g_axis").append("g").attr("id","yAxis").selectAll("text").data(e.slice(h,y)).enter().append("g").attr("id",function(t,e){return e}).append("title").text(function(t){return t.measure}),A.select("#yAxis").selectAll("g").append("text").attr("x",l.padding.left).attr("y",l.line_spacing+l.graph.height/2).text(function(t){return t.measure||t.measure_html}).each(a).attr("transform",function(t,e){return"translate(0,"+(l.line_spacing+l.graph.height)*e+")"}).attr("class",function(t){var e="ytitle";return null!=t.measure_url&&(e+=" link"),e}).on("click",function(t){return null!=t.measure_url?window.open(t.measure_url):null})),A.select("#g_axis").append("g").attr("id","vGrid"),b&&n(L),A.select("#g_axis").append("g").attr("id","hGrid").selectAll("line.horz_grid").data(e).enter().append("line").attr("x1",0).attr("x2",v).attr("y1",function(t,e){return(l.line_spacing+l.graph.height)*e+l.line_spacing+l.graph.height/2}).attr("y2",function(t,e){return(l.line_spacing+l.graph.height)*e+l.line_spacing+l.graph.height/2}).attr("class","horz_grid"),b&&A.select("#g_axis").append("g").attr("class","xAxis").call(T);var I=A.select("#g_data").selectAll(".g_data").data(e.slice(h,y)).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(l.line_spacing+l.graph.height)*e+")"}).attr("cursor","pointer").attr("class","dataset");if(I.selectAll("rect").data(function(t){return t.disp_data}).enter().append("rect").attr("x",function(t){return m(t,L)}).attr("width",function(t){return f(t,L)}).attr("y",l.line_spacing).attr("height",l.graph.height).attr("transform",function(t){return g(t,L)}).attr("rx",function(t){return u()}).attr("ry",function(t){return u()}).attr("class",function(t){if(!l.custom_categories)return 1===t[1]?"rect_has_data":"rect_has_no_data";var a=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];return a&&a.categories?(o.select(this).attr("fill",a.categories[t[1]].color),""):void 0}).on("mouseover",function(t,a){var n=this.getScreenCTM().translate(+this.getAttribute("x"),+this.getAttribute("y"));_.transition().duration(200).style("opacity",.9),_.html(function(){var n="";if(n=l.custom_categories?"&nbsp;"+t[1]+"&nbsp;":1===t[1]?'<i class=" '+l.icon.class_has_data+' tooltip_has_data"></i>':'<i class=" '+l.icon.class_has_no_data+' tooltip_has_no_data"></i>',l.tooltip.description){var r=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];r&&r.description&&r.description[a]&&(n+=" "+r.description[a]+" ")}return l.is_date_only_format?t[2]>o.timeSecond.offset(t[0],86400)?l.date_is_descending?n+s(t[2]).format("l")+" - "+s(t[0]).format("l"):n+s(t[0]).format("l")+" - "+s(t[2]).format("l"):n+s(t[0]).format("l"):t[2]>o.timeSecond.offset(t[0],86400)?l.date_is_descending?n+s(t[2]).format("l")+" "+s(t[2]).format("LTS")+" - "+s(t[0]).format("l")+" "+s(t[0]).format("LTS"):n+s(t[0]).format("l")+" "+s(t[0]).format("LTS")+" - "+s(t[2]).format("l")+" "+s(t[2]).format("LTS"):l.date_is_descending?n+s(t[2]).format("LTS")+" - "+s(t[0]).format("LTS"):n+s(t[0]).format("LTS")+" - "+s(t[2]).format("LTS")}).style("left",function(){return document.body.clientWidth<o.event.pageX+_.property("offsetWidth")+l.tooltip.left_spacing?o.event.pageX-_.property("offsetWidth")-l.tooltip.left_spacing+"px":o.event.pageX+l.tooltip.left_spacing+"px"}),"top"===l.tooltip.position&&(_.style("top",function(){return window.pageYOffset+n.f-l.tooltip.height+"px"}).style("height",l.graph.height+l.tooltip.height+"px"),v-l.margin.right<o.event.pageX+_.property("offsetWidth")+l.tooltip.left_spacing?_.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):_.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===l.tooltip.position&&_.style("top",o.event.pageY+"px")}).on("mouseout",function(){_.transition().duration(500).style("opacity",0)}).on("click",function(t,e){l.onClickBlock.call(this,t,e)}).on("mousemove",function(){_.style("left",function(){return document.body.clientWidth<o.event.pageX+_.property("offsetWidth")+l.tooltip.left_spacing?o.event.pageX-_.property("offsetWidth")-l.tooltip.left_spacing+"px":o.event.pageX+l.tooltip.left_spacing+"px"}),"top"===l.tooltip.position&&(document.body.clientWidth<o.event.pageX+_.property("offsetWidth")?_.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):_.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===l.tooltip.position&&_.style("top",o.event.pageY+"px")}),c(L),l.title.enabled&&A.select("#g_title").append("text").attr("x",l.padding.left).attr("y",l.padding.top).text(l.title.text).attr("class","heading"),l.sub_title.enabled){var B="";b&&(B=l.is_date_only_format?l.sub_title.from_text+" "+s(E).format("MMMM Y")+" "+l.sub_title.to_text+" "+s(z).format("MMMM Y"):l.sub_title.from_text+" "+s(E).format("l")+" "+s(E).format("LTS")+" "+l.sub_title.to_text+" "+s(z).format("l")+" "+s(z).format("LTS")),A.select("#g_title").append("text").attr("x",l.padding.left).attr("y",l.padding.top+l.title.line_spacing).text(B).attr("class","subheading")}if(!l.custom_categories&&l.legend.enabled){var W=A.select("#g_title").append("g").attr("id","g_legend").attr("transform","translate(0,-12)");W.append("rect").attr("x",v+l.margin.right-150).attr("y",l.padding.top).attr("height",15).attr("width",15).attr("class","rect_has_data"),W.append("text").attr("x",v+l.margin.right-150+20).attr("y",l.padding.top+l.legend.line_space-l.legend.offset/2).text(l.legend.has_data_text).attr("class","legend"),W.append("rect").attr("x",v+l.margin.right-150).attr("y",l.padding.top+l.legend.line_space+l.legend.offset).attr("height",15).attr("width",15).attr("class","rect_has_no_data"),W.append("text").attr("x",v+l.margin.right-150+20).attr("y",l.padding.top+2*l.legend.line_space+l.legend.offset/2).text(l.legend.has_no_data_text).attr("class","legend")}l.scale&&A.call(l.zoomed.transform,o.zoomIdentity.translate(l.scale.x,l.scale.x).scale(l.scale.k))})}var o=window.d3?window.d3:"undefined"!=typeof require?require("d3"):void 0,s=window.moment?window.moment:"undefined"!=typeof require?require("moment"):void 0;if(!o)throw new Error("Require D3.js before visavail script");if(!s)throw new Error("Require moment before visavail script");var l={id:"",id_div_container:"visavail_container",id_div_graph:"example",margin:{top:65,right:40,bottom:20,left:100},width:960,moment_locale:window.navigator.userLanguage||window.navigator.language,reduce_space_wrap:35,line_spacing:16,padding:{top:-49,bottom:0,right:0,left:-100},emphasize_year_ticks:!0,emphasize_month_ticks:!0,ticks_for_graph:6,max_display_datasets:0,cur_display_first_dataset:0,display_date_range:[0,0],custom_categories:!1,is_date_only_format:!0,date_in_utc:!0,date_is_descending:!1,show_y_title:!0,defined_blocks:!1,tooltip:{class:"tooltip",height:11,position:"top",left_spacing:0},legend:{enabled:!0,line_space:12,offset:5,has_no_data_text:"No Data available",has_data_text:"Data available"},title:{enabled:!0,text:"Data Availability Plot",line_spacing:16},sub_title:{enabled:!0,from_text:"from",to_text:"to",line_spacing:16},icon:{class_has_data:"fas fa-fw fa-check",class_has_no_data:"fas fa-fw fa-times"},zoom:{enabled:!1,onZoom:function(){},onZoomStart:function(){},onZoomEnd:function(){}},onClickBlock:function(){},graph:{type:"bar",width:20,height:18},responsive:{enabled:!1,onresize:function(){}},custom_time_format:{format_millisecond:".%L",format_second:":%S",format_minute:"%H:%M",format_hour:"%H",format_day:"%a %d",format_week:"%b %d",format_month:"%B",format_year:"%Y"}};if(null!=t)for(var d in t)if(l.hasOwnProperty(d))if("object"==typeof l[d])for(var c in t[d])l[d].hasOwnProperty(c)&&(l[d][c]=t[d][c]);else l[d]=t[d];s.locale(l.moment_locale);var p=s().creationData().locale._longDateFormat;l.locale={dateTime:a(p.LLLL),date:a(p.L),time:a(p.LTS),periods:["AM","PM"],days:s.weekdays(),shortDays:s.weekdaysShort(),months:s.months(),shortMonths:s.monthsShort()},l.custom_time_format||(l.custom_time_format={format_millisecond:a("SSS"),format_second:a(":ss"),format_minute:a(p.LT),format_hour:a(p.LT.substring(0,1)+(n()?" "+p.LT.slice(-1):"")),format_day:a("ddd DD"),format_week:a("MMM DD"),format_month:a("MMMM"),format_year:a("YYYY")}),t.hasOwnProperty("width")||(l.width=document.getElementById(l.id_div_container).offsetWidth),l.id="visavail-"+Math.random().toString(36).substring(7);var _=o.select("body").append("div").attr("class","visavail-tooltip "+l.id).attr("id",l.id).append("div").attr("class",l.tooltip.class+"-"+l.tooltip.position).style("opacity",0);return i.width=function(t){return arguments.length?(l.width=t,i):l.width},i.drawTitle=function(t){return arguments.length?(l.title.enabled=t,i):l.title.enabled},i.maxDisplayDatasets=function(t){return arguments.length?(l.max_display_datasets=t,i):l.max_display_datasets},i.curDisplayFirstDataset=function(t){return arguments.length?(l.cur_display_first_dataset=t,i):l.cur_display_first_dataset},i.emphasizeYearTicks=function(t){return arguments.length?(l.emphasize_year_ticks=t,i):l.emphasize_year_ticks},i.displayDateRange=function(t){return arguments.length?(l.display_date_range=t,document.getElementById(l.id_div_graph)?i.updateGraph():i):l.display_date_range},i.resizeWidth=function(t){return l.width=t,i.updateGraph()},i.updateGraph=function(t){if(document.getElementById(l.id_div_graph)&&""!=document.getElementById(l.id_div_graph).innerHTML){if(document.getElementById(l.id_div_graph).innerHTML="",t)return i.createGraph(t);o.select("#"+l.id_div_graph).call(i)}return i},i.createGraph=function(t){return o.select("#"+l.id_div_graph).datum(t).call(i),i},i.destroy=function(t){return document.getElementById(l.id_div_graph)&&(document.getElementById(l.id_div_graph).innerHTML=""),document.getElementById(l.id)&&document.getElementById(l.id).remove(),Object.keys(l).forEach(function(t){l[t]=null}),null},l.responsive.function=function(){l.id_div_container&&document.getElementById(l.id_div_graph)&&""!=document.getElementById(l.id_div_graph).innerHTML&&i.resizeWidth(document.getElementById(l.id_div_container).offsetWidth)},l.responsive.enabled&&window.addEventListener("resize",l.responsive.function),i.createGraph(e),i}var e={};return Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Element.prototype.remove=Element.prototype.remove||function(){this.parentNode&&this.parentNode.removeChild(this)},e.generate=function(e,a){return new t(e,a)},e});