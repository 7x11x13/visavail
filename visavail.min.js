(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.visavail=e()})(this,function(){function t(t,e){function a(t){var e={ddd:"a",dddd:"A",MMM:"b",MMMM:"B",lll:"c",DD:"d",D:"e","YYYY-MM-DD":"F",HH:"H",H:"k",hh:"I",h:"l",DDDD:"j",DDD:"-j",MM:"m",M:"-m",mm:"M",m:"-M",A:"p",a:"P",ss:"S",s:"-S",E:"u",d:"w",WW:"W",ll:"x",LTS:"X",YY:"y",YYYY:"Y",ZZ:"z",z:"Z",SSS:"f","%":"%"},a=t.split(/( |\/|:)/),n=a.map(function(t){return":"==t[0]||"/"==t[0]||" "==t[0]?t:e.hasOwnProperty(t)?"%"+e[t]:t.length>0?"["+t+"]":t}).join("");return n}function n(){return l.LTS.indexOf("a")>-1||l.LTS.indexOf("A")>-1?["AM","PM"]:[]}function i(t){t.each(function(e){function a(){for(var t=r.select(this),e=t.node().getComputedTextLength(),a=t.text();e>-1*s.padding.left+s.reduce_space_wrap&&a.length>0;)a=a.slice(0,-1),t.text(a+"..."),e=t.node().getComputedTextLength()}function n(t){L.select("#vGrid").selectAll("line.vert_grid").data(t.ticks()).enter().append("line").attr("x1",function(e){return t(e)}).attr("x2",function(e){return t(e)}).attr("y1",0).attr("y2",s.graph.height*x+s.line_spacing*x-1+s.margin.bottom).attr("class","vert_grid")}function i(t){return+t===+new Date(t.getFullYear(),0,1,0,0,0)}function l(t){return+t===+new Date(t.getFullYear(),t.getMonth(),1,0,0,0)}function d(t){var e=t.ticks(),a=e.map(i),n=e.map(l);s.emphasize_year_ticks&&!a.every(function(t){return t===!0})&&n.every(function(t){return t===!0})&&(r.selectAll("#"+s.id_div_graph+" g.tick").each(function(t,e){a[e]&&r.select(this).attr("class","tick x_tick_emph")}),r.selectAll("#"+s.id_div_graph+" .vert_grid").each(function(t,e){a[e]&&r.select(this).attr("class","vert_grid vert_grid_emph")})),s.emphasize_month_ticks&&!n.every(function(t){return t===!0})&&(r.selectAll("#"+s.id_div_graph+" g.tick").each(function(t,e){n[e]&&r.select(this).attr("class","tick x_tick_emph")}),r.selectAll("#"+s.id_div_graph+" g.vert_grid").each(function(t,e){n[e]&&r.select(this).attr("class","vert_grid vert_grid_emph")}))}function c(){null==r.event.sourceEvent&&"zoom"!==r.event.type||(r.event.transform.k||r.event.transform.x)&&(s.xScale=r.event.transform.rescaleX(z),null!==r.event.sourceEvent&&"zoom"==r.event.type&&p.style("left",r.event.pageX+"px"),A.selectAll("rect").attr("x",function(t){return g(t,s.xScale)}).attr("width",function(t){return f(t,s.xScale)}).attr("transform",function(t){return h(t,s.xScale)}),L.select(".xAxis").call(T.scale(s.xScale)),L.select("#vGrid").selectAll("line").remove(),n(s.xScale),d(s.xScale),s.zoom.onZoom.call(this,s.xScale.domain()))}function g(t,e){var a=e(t[0]);return s.date_is_descending&&(a=e(t[2])),isNaN(a)||a<0?0:"rhombus"==s.graph.type||"circle"==s.graph.type?e(t[0])-s.graph.width/2:a}function f(t,e){var a=e(t[0]),n=e(t[2]);return s.date_is_descending&&(a=e(t[2]),n=e(t[0])),isNaN(a)||isNaN(n)||!s.date_is_descending&&n-a<0||n<0&&a<0?0:s.date_is_descending&&n-a<0?-1*(n-a):"rhombus"==s.graph.type||"circle"==s.graph.type?a<0?0:s.graph.width:a<0&&n>0?n>y?y:n:n<0&&a>0?a>y?y:a:n>y?y-a<0?0:y-a:n-a}function h(t,e){var a=e(t[0]);return("rhombus"==s.graph.type||"circle"==s.graph.type)&&a>0?"rotate(45 "+a+"  "+(s.graph.height/2+s.line_spacing)+")":("rhombus"==s.graph.type||"circle"==s.graph.type)&&a<=0?"rotate(45 0 "+(s.graph.height/2+s.line_spacing)+")":void 0}function _(){return"circle"==s.graph.type?2e5:0}r.timeFormatDefaultLocale(s.locale);var u,m,y=s.width-s.margin.left-s.margin.right,v=0;0!==s.max_display_datasets?(u=s.cur_display_first_dataset,m=s.cur_display_first_dataset+s.max_display_datasets>e.length?e.length:s.cur_display_first_dataset+s.max_display_datasets,v=Math.ceil(e.length/s.max_display_datasets)):(u=0,m=e.length),t.attr("data-max-pages",v);for(var x=m-u,b=s.graph.height*x+s.line_spacing*x-1,w=0;w<e.length;w++)if(e[w].description&&(s.tooltip.description=!0),null!=e[w].data[0]&&3==e[w].data[0].length){s.defined_blocks=!0,Number.isInteger(e[w].data[0][1])||(s.custom_categories=!0);break}if(s.date_in_utc)var M=function(t){return o.utc(t).toDate()},S=function(t){return o.utc(t).toDate()};else var M=function(t){return o(t).toDate()},S=function(t){return o(t).toDate()};var D=new RegExp(/^\d{4}-\d{2}-\d{2}$/),Y=new RegExp(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/);e.forEach(function(t){t.data.forEach(function(e){if(!(e[0]instanceof Date)){if(D.test(e[0]))e[0]=M(e[0]);else{if(!Y.test(e[0]))throw new Error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.");e[0]=S(e[0]),s.is_date_only_format=!1}s.defined_blocks?D.test(e[2])?e[2]=M(e[2]):Y.test(e[2])?e[2]=S(e[2]):(e[2]=e[0],"rhombus"!=s.graph.type&&console.error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.")):e[2]=r.timeSecond.offset(e[0],t.interval_s)}})});var k=o().year(2999),E=o().year(0);e.forEach(function(t,a){var n=[],i=t.data.length;t.data.forEach(function(t,e){o(t[2]).isSameOrAfter(E)&&(E=t[2]),o(t[0]).isSameOrBefore(k)&&(k=t[0]),0!==e&&e<i?t[1]===n[n.length-1][1]?s.defined_blocks?n[n.length-1][2].getTime()===t[0].getTime()?(n[n.length-1][2]=t[2],n[n.length-1][3]=1):n.push(t):(n[n.length-1][2]=t[2],n[n.length-1][3]=1):(s.defined_blocks||(n[n.length-1][2]=t[0]),n.push(t)):0===e&&(t[3]=0,n.push(t))}),e[a].disp_data=n}),0!=s.display_date_range[0]&&(k=o(s.display_date_range[0])),0!=s.display_date_range[1]&&(E=o(s.display_date_range[1]));var z=r.scaleTime().domain([k,E]).range([0,y]);s.date_is_descending&&z.domain([E,k]);var T=r.axisTop(z).scale(z),L=r.select(this).append("svg").attr("width",y+s.margin.left+s.margin.right).attr("height",b+s.margin.top+s.margin.bottom).append("g").attr("transform","translate("+s.margin.left+","+s.margin.top+")");L.append("g").attr("id","g_title"),L.append("g").attr("id","g_axis"),s.zoom.enabled&&(s.zoomed=r.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[y,s.height]]).extent([[0,0],[y,s.height]]).on("zoom",c).on("start",function(){var t=r.event;t&&"brush"===t.type||(startEvent=t,s.zoom.onZoomStart.call(this,t))}).on("end",function(){var t=r.event.sourceEvent;t&&"brush"===t.type||t&&startEvent.clientX===t.clientX&&startEvent.clientY===t.clientY||(s.scale=r.zoomTransform(L.node()),s.zoom.onZoomEnd.call(this,z.domain()))}),L.append("rect").attr("id","zoom").attr("width",y).attr("height",b).attr("fill-opacity",0).attr("cursor","ew-resize").attr("x",0).attr("y",0),L.call(s.zoomed)),L.append("g").attr("id","g_data"),s.show_y_title&&(L.select("#g_axis").append("g").attr("id","yAxis").selectAll("text").data(e.slice(u,m)).enter().append("g").attr("id",function(t,e){return e}).append("title").text(function(t){return t.measure}),L.select("#yAxis").selectAll("g").append("text").attr("x",s.padding.left).attr("y",s.line_spacing+s.graph.height/2).text(function(t){return t.measure||t.measure_html}).each(a).attr("transform",function(t,e){return"translate(0,"+(s.line_spacing+s.graph.height)*e+")"}).attr("class",function(t){var e="ytitle";return null!=t.measure_url&&(e+=" link"),e}).on("click",function(t){return null!=t.measure_url?window.open(t.measure_url):null})),L.select("#g_axis").append("g").attr("id","vGrid"),x&&n(z),L.select("#g_axis").append("g").attr("id","hGrid").selectAll("line.horz_grid").data(e).enter().append("line").attr("x1",0).attr("x2",y).attr("y1",function(t,e){return(s.line_spacing+s.graph.height)*e+s.line_spacing+s.graph.height/2}).attr("y2",function(t,e){return(s.line_spacing+s.graph.height)*e+s.line_spacing+s.graph.height/2}).attr("class","horz_grid"),x&&L.select("#g_axis").append("g").attr("class","xAxis").call(T);var A=L.select("#g_data").selectAll(".g_data").data(e.slice(u,m)).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(s.line_spacing+s.graph.height)*e+")"}).attr("cursor","pointer").attr("class","dataset");if(A.selectAll("rect").data(function(t){return t.disp_data}).enter().append("rect").attr("x",function(t){return g(t,z)}).attr("width",function(t){return f(t,z)}).attr("y",s.line_spacing).attr("height",s.graph.height).attr("transform",function(t){return h(t,z)}).attr("rx",function(t){return _()}).attr("ry",function(t){return _()}).attr("class",function(t){if(!s.custom_categories)return 1===t[1]?"rect_has_data":"rect_has_no_data";var a=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];return a&&a.categories?(r.select(this).attr("fill",a.categories[t[1]].color),""):void 0}).on("mouseover",function(t,a){var n=this.getScreenCTM().translate(+this.getAttribute("x"),+this.getAttribute("y"));p.transition().duration(200).style("opacity",.9),p.html(function(){var n="";if(n=s.custom_categories?"&nbsp;"+t[1]+"&nbsp;":1===t[1]?'<i class=" '+s.icon.class_has_data+' tooltip_has_data"></i>':'<i class=" '+s.icon.class_has_no_data+' tooltip_has_no_data"></i>',s.tooltip.description){var i=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];i&&i.description&&i.description[a]&&(n+=" "+i.description[a]+" ")}return s.is_date_only_format?t[2]>r.timeSecond.offset(t[0],86400)?s.date_is_descending?n+o(t[2]).format("l")+" - "+o(t[0]).format("l"):n+o(t[0]).format("l")+" - "+o(t[2]).format("l"):n+o(t[0]).format("l"):t[2]>r.timeSecond.offset(t[0],86400)?s.date_is_descending?n+o(t[2]).format("l")+" "+o(t[2]).format("LTS")+" - "+o(t[0]).format("l")+" "+o(t[0]).format("LTS"):n+o(t[0]).format("l")+" "+o(t[0]).format("LTS")+" - "+o(t[2]).format("l")+" "+o(t[2]).format("LTS"):s.date_is_descending?n+o(t[2]).format("LTS")+" - "+o(t[0]).format("LTS"):n+o(t[0]).format("LTS")+" - "+o(t[2]).format("LTS")}).style("left",function(){return document.body.clientWidth<r.event.pageX+p.property("offsetWidth"+s.tooltip.left_spacing)?r.event.pageX-p.property("offsetWidth")-s.tooltip.left_spacing+"px":r.event.pageX+s.tooltip.left_spacing+"px"}),"top"===s.tooltip.position&&(p.style("top",function(){return window.pageYOffset+n.f-s.tooltip.height+"px"}).style("height",s.graph.height+s.tooltip.height+"px"),y+s.margin.right<r.event.pageX+p.property("offsetWidth")?p.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):p.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===s.tooltip.position&&p.style("top",r.event.pageY+"px")}).on("mouseout",function(){p.transition().duration(500).style("opacity",0)}).on("click",function(t,e){s.onClickBlock.call(this,t,e)}).on("mousemove",function(){p.style("left",function(){return document.body.clientWidth<r.event.pageX+p.property("offsetWidth")+s.tooltip.left_spacing?r.event.pageX-p.property("offsetWidth")-s.tooltip.left_spacing+"px":r.event.pageX+s.tooltip.left_spacing+"px"}),"top"===s.tooltip.position&&(document.body.clientWidth<r.event.pageX+p.property("offsetWidth")?p.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):p.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===s.tooltip.position&&p.style("top",r.event.pageY+"px")}),d(z),s.title.enabled&&L.select("#g_title").append("text").attr("x",s.padding.left).attr("y",s.padding.top).text(s.title.text).attr("class","heading"),s.sub_title.enabled){var B="";x&&(B=s.is_date_only_format?s.sub_title.from_text+" "+o(k).format("MMMM Y")+" "+s.sub_title.to_text+" "+o(E).format("MMMM Y"):s.sub_title.from_text+" "+o(k).format("l")+" "+o(k).format("LTS")+" "+s.sub_title.to_text+" "+o(E).format("l")+" "+o(E).format("LTS")),L.select("#g_title").append("text").attr("x",s.padding.left).attr("y",s.padding.top+s.title.line_spacing).text(B).attr("class","subheading")}if(!s.custom_categories&&s.legend.enabled){var I=L.select("#g_title").append("g").attr("id","g_legend").attr("transform","translate(0,-12)");I.append("rect").attr("x",y+s.margin.right-150).attr("y",s.padding.top).attr("height",15).attr("width",15).attr("class","rect_has_data"),I.append("text").attr("x",y+s.margin.right-150+20).attr("y",s.padding.top+s.legend.line_space-s.legend.offset/2).text(s.legend.has_data_text).attr("class","legend"),I.append("rect").attr("x",y+s.margin.right-150).attr("y",s.padding.top+s.legend.line_space+s.legend.offset).attr("height",15).attr("width",15).attr("class","rect_has_no_data"),I.append("text").attr("x",y+s.margin.right-150+20).attr("y",s.padding.top+2*s.legend.line_space+s.legend.offset/2).text(s.legend.has_no_data_text).attr("class","legend")}s.scale&&L.call(s.zoomed.transform,r.zoomIdentity.translate(s.scale.x,s.scale.x).scale(s.scale.k))})}var r=window.d3?window.d3:"undefined"!=typeof require?require("d3"):void 0,o=window.moment?window.moment:"undefined"!=typeof require?require("moment"):void 0;if(!r)throw new Error("Require D3.js before visavail script");if(!o)throw new Error("Require moment before visavail script");var s={id:"",id_div_container:"visavail_container",id_div_graph:"example",margin:{top:65,right:40,bottom:20,left:100},width:960,reduce_space_wrap:35,line_spacing:16,padding:{top:-49,bottom:0,right:0,left:-100},emphasize_year_ticks:!0,emphasize_month_ticks:!0,max_display_datasets:0,cur_display_first_dataset:0,display_date_range:[0,0],custom_categories:!1,is_date_only_format:!0,date_in_utc:!0,date_is_descending:!1,show_y_title:!0,defined_blocks:!1,tooltip:{class:"tooltip",height:11,position:"top",left_spacing:0},legend:{enabled:!0,line_space:12,offset:5,has_no_data_text:"No Data available",has_data_text:"Data available"},title:{enabled:!0,text:"Data Availability Plot",line_spacing:16},sub_title:{enabled:!0,from_text:"from",to_text:"to",line_spacing:16},icon:{class_has_data:"fas fa-fw fa-check",class_has_no_data:"fas fa-fw fa-times"},zoom:{enabled:!1,onZoom:function(){},onZoomStart:function(){},onZoomEnd:function(){}},onClickBlock:function(){},graph:{type:"bar",width:20,height:18},responsive:{enabled:!1,onresize:function(){}}},l=o().creationData().locale._longDateFormat;if(s.locale={dateTime:a(l.LLLL),date:a(l.L),time:a(l.LTS),periods:n(),days:o.weekdays(),shortDays:o.weekdaysShort(),months:o.months(),shortMonths:o.monthsShort()},s.customTimeFormat={formatMillisecond:".%L",formatSecond:":%S",formatMinute:"%H:%M",formatHour:"%H",formatDay:"%a %d",formatWeek:"%b %d",formatMonth:"%B",formatYear:"%Y"},null!=t)for(var d in t)if(s.hasOwnProperty(d))if("object"==typeof s[d])for(var c in t[d])s[d].hasOwnProperty(c)&&(s[d][c]=t[d][c]);else s[d]=t[d];t.hasOwnProperty("width")||(s.width=document.getElementById(s.id_div_container).offsetWidth),s.id="visavail-"+Math.random().toString(36).substring(7);var p=r.select("body").append("div").attr("class","visavail-tooltip "+s.id).attr("id",s.id).append("div").attr("class",s.tooltip.class+"-"+s.tooltip.position).style("opacity",0);return i.width=function(t){return arguments.length?(s.width=t,i):s.width},i.drawTitle=function(t){return arguments.length?(s.title.enabled=t,i):s.title.enabled},i.maxDisplayDatasets=function(t){return arguments.length?(s.max_display_datasets=t,i):s.max_display_datasets},i.curDisplayFirstDataset=function(t){return arguments.length?(s.cur_display_first_dataset=t,i):s.cur_display_first_dataset},i.emphasizeYearTicks=function(t){return arguments.length?(s.emphasize_year_ticks=t,i):s.emphasize_year_ticks},i.displayDateRange=function(t){return arguments.length?(s.display_date_range=t,document.getElementById(s.id_div_graph)?i.updateGraph():i):s.display_date_range},i.resizeWidth=function(t){return s.width=t,i.updateGraph()},i.updateGraph=function(t){if(document.getElementById(s.id_div_graph)&&""!=document.getElementById(s.id_div_graph).innerHTML){if(document.getElementById(s.id_div_graph).innerHTML="",t)return i.createGraph(t);r.select("#"+s.id_div_graph).call(i)}return i},i.createGraph=function(t){return r.select("#"+s.id_div_graph).datum(t).call(i),i},i.destroy=function(t){return document.getElementById(s.id_div_graph)&&(document.getElementById(s.id_div_graph).innerHTML=""),document.getElementById(s.id)&&document.getElementById(s.id).remove(),Object.keys(s).forEach(function(t){s[t]=null}),null},s.responsive.function=function(){s.id_div_container&&document.getElementById(s.id_div_graph)&&""!=document.getElementById(s.id_div_graph).innerHTML&&i.resizeWidth(document.getElementById(s.id_div_container).offsetWidth)},s.responsive.enabled&&window.addEventListener("resize",s.responsive.function),i.createGraph(e),i}var e={};return Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Element.prototype.remove=Element.prototype.remove||function(){this.parentNode&&this.parentNode.removeChild(this)},e.generate=function(e,a){return new t(e,a)},e});