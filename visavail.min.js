(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.visavail=e()})(this,function(){function t(t,e){function a(t){var e={ddd:"a",dddd:"A",MMM:"b",MMMM:"B",lll:"c",DD:"d",D:"e","YYYY-MM-DD":"F",HH:"H",H:"k",hh:"I",h:"l",DDDD:"j",DDD:"-j",MM:"m",M:"-m",mm:"M",m:"-M",A:"p",a:"P",ss:"S",s:"-S",E:"u",d:"w",WW:"W",ll:"x",LTS:"X",YY:"y",YYYY:"Y",ZZ:"z",z:"Z",SSS:"f","%":"%"},a=t.split(/( |\/|:)/),n=a.map(function(t){return":"==t[0]||"/"==t[0]||" "==t[0]?t:e.hasOwnProperty(t)?"%"+e[t]:t.length>0?"["+t+"]":t}).join("");return n}function n(){return s.LTS.indexOf("a")>-1||s.LTS.indexOf("A")>-1?["AM","PM"]:[]}function i(t){t.each(function(e){function a(){for(var t=r.select(this),e=t.node().getComputedTextLength(),a=t.text();e>-1*l.padding.left+l.reduce_space_wrap&&a.length>0;)a=a.slice(0,-1),t.text(a+"..."),e=t.node().getComputedTextLength()}function n(t){T.select("#vGrid").selectAll("line.vert_grid").data(t.ticks()).enter().append("line").attr("x1",function(e){return t(e)}).attr("x2",function(e){return t(e)}).attr("y1",0).attr("y2",l.graph.height*x+l.line_spacing*x-1+l.margin.bottom).attr("class","vert_grid")}function i(t){return+t===+new Date(t.getFullYear(),0,1,0,0,0)}function s(t){return+t===+new Date(t.getFullYear(),t.getMonth(),1,0,0,0)}function d(t){var e=t.ticks(),a=e.map(i),n=e.map(s);l.emphasize_year_ticks&&!a.every(function(t){return t===!0})&&n.every(function(t){return t===!0})&&(r.selectAll("#"+l.id_div_graph+" g.tick").each(function(t,e){a[e]&&r.select(this).attr("class","tick x_tick_emph")}),r.selectAll("#"+l.id_div_graph+" .vert_grid").each(function(t,e){a[e]&&r.select(this).attr("class","vert_grid vert_grid_emph")})),l.emphasize_month_ticks&&!n.every(function(t){return t===!0})&&(r.selectAll("#"+l.id_div_graph+" g.tick").each(function(t,e){n[e]&&r.select(this).attr("class","tick x_tick_emph")}),r.selectAll("#"+l.id_div_graph+" g.vert_grid").each(function(t,e){n[e]&&r.select(this).attr("class","vert_grid vert_grid_emph")}))}function c(){null==r.event.sourceEvent&&"zoom"!==r.event.type||(r.event.transform.k||r.event.transform.x)&&(l.xScale=r.event.transform.rescaleX(E),null!==r.event.sourceEvent&&"zoom"==r.event.type&&p.style("left",r.event.pageX+"px"),L.selectAll("rect").attr("x",function(t){return g(t,l.xScale)}).attr("width",function(t){return h(t,l.xScale)}).attr("transform",function(t){return f(t,l.xScale)}),T.select(".xAxis").call(A.scale(l.xScale)),T.select("#vGrid").selectAll("line").remove(),n(l.xScale),d(l.xScale),l.zoom.onzoom.call(this,l.xScale.domain()))}function g(t,e){return e(t[0])<0?0:"rhombus"==l.graph.type||"circle"==l.graph.type?e(t[0])-l.graph.width/2:e(t[0])}function h(t,e){return e(t[2])-e(t[0])<0||e(t[2])<0&&e(t[1])<0?0:"rhombus"==l.graph.type||"circle"==l.graph.type?e(t[0])<0?0:l.graph.width:e(t[0])<0&&e(t[2])>0?e(t[2]):e(t[2])<0&&e(t[1])>0?e(t[1]):e(t[2])-e(t[0])}function f(t,e){return("rhombus"==l.graph.type||"circle"==l.graph.type)&&e(t[0])>0?"rotate(45 "+e(t[0])+"  "+(l.graph.height/2+l.line_spacing)+")":("rhombus"==l.graph.type||"circle"==l.graph.type)&&e(t[0])<=0?"rotate(45 0 "+(l.graph.height/2+l.line_spacing)+")":void 0}function u(){return"circle"==l.graph.type?2e5:0}r.timeFormatDefaultLocale(l.locale);var _,m,y=l.width-l.margin.left-l.margin.right,v=0;0!==l.max_display_datasets?(_=l.cur_display_first_dataset,m=l.cur_display_first_dataset+l.max_display_datasets>e.length?e.length:l.cur_display_first_dataset+l.max_display_datasets,v=Math.ceil(e.length/l.max_display_datasets)):(_=0,m=e.length),t.attr("data-max-pages",v);for(var x=m-_,b=l.graph.height*x+l.line_spacing*x-1,w=0;w<e.length;w++)if(e[w].description&&(l.tooltip.description=!0),null!=e[w].data[0]&&3==e[w].data[0].length){l.definedBlocks=!0,Number.isInteger(e[w].data[0][1])||(l.custom_categories=!0);break}if(l.date_in_utc)var M=function(t){return o.utc(t).toDate()},D=function(t){return o.utc(t).toDate()};else var M=function(t){return o(t).toDate()},D=function(t){return o(t).toDate()};var z=new RegExp(/^\d{4}-\d{2}-\d{2}$/),Y=new RegExp(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/);e.forEach(function(t){t.data.forEach(function(e){if(!(e[0]instanceof Date)){if(z.test(e[0]))e[0]=M(e[0]);else{if(!Y.test(e[0]))throw new Error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.");e[0]=D(e[0]),l.is_date_only_format=!1}l.definedBlocks?z.test(e[2])?e[2]=M(e[2]):Y.test(e[2])?e[2]=D(e[2]):(e[2]=e[0],"rhombus"!=l.graph.type&&console.error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.")):e[2]=r.timeSecond.offset(e[0],t.interval_s)}})});var k=o().year(2999),S=o().year(0);e.forEach(function(t,a){var n=[],i=t.data.length;t.data.forEach(function(t,e){o(t[2]).isSameOrAfter(S)&&(S=t[2]),o(t[0]).isSameOrBefore(k)&&(k=t[0]),0!==e&&e<i?t[1]===n[n.length-1][1]?l.definedBlocks?n[n.length-1][2].getTime()===t[0].getTime()?(n[n.length-1][2]=t[2],n[n.length-1][3]=1):n.push(t):(n[n.length-1][2]=t[2],n[n.length-1][3]=1):(t[3]=0,l.definedBlocks||(n[n.length-1][2]=t[0]),n.push(t)):0===e&&(t[3]=0,n.push(t))}),e[a].disp_data=n}),0!=l.display_date_range[0]&&(k=o(l.display_date_range[0])),0!=l.display_date_range[1]&&(S=o(l.display_date_range[1]));var E=r.scaleTime().domain([k,S]).range([0,y]),A=r.axisTop(E).scale(E),T=r.select(this).append("svg").attr("width",y+l.margin.left+l.margin.right).attr("height",b+l.margin.top+l.margin.bottom).append("g").attr("transform","translate("+l.margin.left+","+l.margin.top+")");T.append("g").attr("id","g_title"),T.append("g").attr("id","g_axis"),l.zoom.enabled&&(l.zoomed=r.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[y,l.height]]).extent([[0,0],[y,l.height]]).on("zoom",c).on("start",function(){var t=r.event;t&&"brush"===t.type||(startEvent=t,l.zoom.onzoomstart.call(this,t))}).on("end",function(){var t=r.event.sourceEvent;t&&"brush"===t.type||t&&startEvent.clientX===t.clientX&&startEvent.clientY===t.clientY||(l.scale=r.zoomTransform(T.node()),l.zoom.onzoomend.call(this,E.domain()))}),T.append("rect").attr("id","zoom").attr("width",y).attr("height",b).attr("fill-opacity",0).attr("cursor","ew-resize").attr("x",0).attr("y",0),T.call(l.zoomed)),T.append("g").attr("id","g_data"),l.show_y_title&&(T.select("#g_axis").append("g").attr("id","yAxis").selectAll("text").data(e.slice(_,m)).enter().append("g").attr("id",function(t,e){return e}).append("title").text(function(t){return t.measure}),T.select("#yAxis").selectAll("g").append("text").attr("x",l.padding.left).attr("y",l.line_spacing+l.graph.height/2).text(function(t){if(null==t.measure_html)return t.measure}).each(a).attr("transform",function(t,e){return"translate(0,"+(l.line_spacing+l.graph.height)*e+")"}).attr("class",function(t){var e="ytitle";return null!=t.measure_url&&(e+=" link"),e}).on("click",function(t){return null!=t.measure_url?window.open(t.measure_url):null}),T.select("#yAxis").selectAll("g").insert("foreignObject",":first-child").attr("x",l.padding.left).attr("y",l.line_spacing).attr("transform",function(t,e){return"translate(0,"+(l.line_spacing+l.graph.height)*e+")"}).attr("width",-1*l.padding.left).attr("height",l.graph.height).attr("class","ytitle").html(function(t){if(null!=t.measure_html)return t.measure_html})),T.select("#g_axis").append("g").attr("id","vGrid"),x&&n(E),T.select("#g_axis").append("g").attr("id","hGrid").selectAll("line.horz_grid").data(e).enter().append("line").attr("x1",0).attr("x2",y).attr("y1",function(t,e){return(l.line_spacing+l.graph.height)*e+l.line_spacing+l.graph.height/2}).attr("y2",function(t,e){return(l.line_spacing+l.graph.height)*e+l.line_spacing+l.graph.height/2}).attr("class","horz_grid"),x&&T.select("#g_axis").append("g").attr("class","xAxis").call(A);var L=T.select("#g_data").selectAll(".g_data").data(e.slice(_,m)).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(l.line_spacing+l.graph.height)*e+")"}).attr("cursor","pointer").attr("class","dataset");if(L.selectAll("rect").data(function(t){return t.disp_data}).enter().append("rect").attr("x",function(t){return g(t,E)}).attr("width",function(t){return h(t,E)}).attr("y",l.line_spacing).attr("height",l.graph.height).attr("transform",function(t){return f(t,E)}).attr("rx",function(t){return u()}).attr("ry",function(t){return u()}).attr("class",function(t){if(!l.custom_categories)return 1===t[1]?"rect_has_data":"rect_has_no_data";var a=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];return a&&a.categories?(r.select(this).attr("fill",a.categories[t[1]].color),""):void 0}).on("mouseover",function(t,a){var n=this.getScreenCTM().translate(+this.getAttribute("x"),+this.getAttribute("y"));p.transition().duration(200).style("opacity",.9),p.html(function(){var n="";if(n=l.custom_categories?"&nbsp;"+t[1]+"&nbsp;":1===t[1]?'<i class=" '+l.icon.class_has_data+' tooltip_has_data"></i>':'<i class=" '+l.icon.class_has_no_data+' tooltip_has_no_data"></i>',l.tooltip.description){var i=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];i&&i.description&&i.description[a]&&(n+=" "+i.description[a]+" ")}return l.is_date_only_format?t[2]>r.timeSecond.offset(t[0],86400)?n+o(t[0]).format("l")+" - "+o(t[2]).format("l"):n+o(t[0]).format("l"):t[2]>r.timeSecond.offset(t[0],86400)?n+o(t[0]).format("l")+" "+o(t[0]).format("LTS")+" - "+o(t[2]).format("l")+" "+o(t[2]).format("LTS"):n+o(t[0]).format("LTS")+" - "+o(t[2]).format("LTS")}).style("left",function(){return document.body.clientWidth<r.event.pageX+p.property("offsetWidth"+l.tooltip.left_spacing)?r.event.pageX-p.property("offsetWidth")-l.tooltip.left_spacing+"px":r.event.pageX+l.tooltip.left_spacing+"px"}),"top"===l.tooltip.position&&(p.style("top",function(){return window.pageYOffset+n.f-l.tooltip.height+"px"}).style("height",l.graph.height+l.tooltip.height+"px"),y+l.margin.right<r.event.pageX+p.property("offsetWidth")?p.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):p.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===l.tooltip.position&&p.style("top",r.event.pageY+"px")}).on("mouseout",function(){p.transition().duration(500).style("opacity",0)}).on("click",function(t,e){l.onclickblock.call(this,t,e)}).on("mousemove",function(){p.style("left",function(){return document.body.clientWidth<r.event.pageX+p.property("offsetWidth")+l.tooltip.left_spacing?r.event.pageX-p.property("offsetWidth")-l.tooltip.left_spacing+"px":r.event.pageX+l.tooltip.left_spacing+"px"}),"top"===l.tooltip.position&&(document.body.clientWidth<r.event.pageX+p.property("offsetWidth")?p.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):p.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===l.tooltip.position&&p.style("top",r.event.pageY+"px")}),d(E),l.title.enabled&&T.select("#g_title").append("text").attr("x",l.padding.left).attr("y",l.padding.top).text(l.title.text).attr("class","heading"),l.sub_title.enabled){var B="";x&&(B=l.is_date_only_format?l.sub_title.from_text+" "+o(k).format("MMMM Y")+" "+l.sub_title.to_text+" "+o(S).format("MMMM Y"):l.sub_title.from_text+" "+o(k).format("l")+" "+o(k).format("LTS")+" "+l.sub_title.to_text+" "+o(S).format("l")+" "+o(S).format("LTS")),T.select("#g_title").append("text").attr("x",l.padding.left).attr("y",l.padding.top+l.title.line_spacing).text(B).attr("class","subheading")}if(!l.custom_categories&&l.legend.enabled){var W=T.select("#g_title").append("g").attr("id","g_legend").attr("transform","translate(0,-12)");W.append("rect").attr("x",y+l.margin.right-150).attr("y",l.padding.top).attr("height",15).attr("width",15).attr("class","rect_has_data"),W.append("text").attr("x",y+l.margin.right-150+20).attr("y",l.padding.top+l.legend.line_space-l.legend.offset/2).text(l.legend.has_data_text).attr("class","legend"),W.append("rect").attr("x",y+l.margin.right-150).attr("y",l.padding.top+l.legend.line_space+l.legend.offset).attr("height",15).attr("width",15).attr("class","rect_has_no_data"),W.append("text").attr("x",y+l.margin.right-150+20).attr("y",l.padding.top+2*l.legend.line_space+l.legend.offset/2).text(l.legend.has_no_data_text).attr("class","legend")}l.scale&&T.call(l.zoomed.transform,r.zoomIdentity.translate(l.scale.x,l.scale.x).scale(l.scale.k))})}var r=window.d3?window.d3:"undefined"!=typeof require?require("d3"):void 0,o=window.moment?window.moment:"undefined"!=typeof require?require("moment"):void 0;if(!r)throw new Error("Require D3.js before visavail script");if(!o)throw new Error("Require moment before visavail script");var l={id:"",id_div_container:"visavail_container",id_div_graph:"example",margin:{top:65,right:40,bottom:20,left:100},width:960,reduce_space_wrap:35,line_spacing:16,padding:{top:-49,bottom:0,right:0,left:-100},emphasize_year_ticks:!0,emphasize_month_ticks:!0,max_display_datasets:0,cur_display_first_dataset:0,display_date_range:[0,0],custom_categories:!1,is_date_only_format:!0,tooltip:{class:"tooltip",height:11,position:"top",left_spacing:0},legend:{enabled:!0,line_space:12,offset:5,has_no_data_text:"No Data available",has_data_text:"Data available"},title:{enabled:!0,text:"Data Availability Plot",line_spacing:16},sub_title:{enabled:!0,from_text:"from",to_text:"to",line_spacing:16},show_y_title:!0,icon:{class_has_data:"fas fa-fw fa-check",class_has_no_data:"fas fa-fw fa-times"},date_in_utc:!0,zoom:{enabled:!1,onzoom:function(){},onzoomstart:function(){},onzoomend:function(){}},onclickblock:function(){},definedBlocks:!1,graph:{type:"bar",width:20,height:18},responsive:{enabled:!1,onresize:function(){}}},s=o().creationData().locale._longDateFormat;if(l.locale={dateTime:a(s.LLLL),date:a(s.L),time:a(s.LTS),periods:n(),days:o.weekdays(),shortDays:o.weekdaysShort(),months:o.months(),shortMonths:o.monthsShort()},l.customTimeFormat={formatMillisecond:".%L",formatSecond:":%S",formatMinute:"%H:%M",formatHour:"%H",formatDay:"%a %d",formatWeek:"%b %d",formatMonth:"%B",formatYear:"%Y"},null!=t)for(var d in t)if(l.hasOwnProperty(d))if("object"==typeof l[d])for(var c in t[d])l[d].hasOwnProperty(c)&&(l[d][c]=t[d][c]);else l[d]=t[d];t.hasOwnProperty("width")||(l.width=document.getElementById(l.id_div_container).offsetWidth),l.id="visavail-"+Math.random().toString(36).substring(7);var p=r.select("body").append("div").attr("class","visavail-tooltip "+l.id).attr("id",l.id).append("div").attr("class",l.tooltip.class+"-"+l.tooltip.position).style("opacity",0);return i.width=function(t){return arguments.length?(l.width=t,i):l.width},i.drawTitle=function(t){return arguments.length?(l.title.enabled=t,i):l.title.enabled},i.maxDisplayDatasets=function(t){return arguments.length?(l.max_display_datasets=t,i):l.max_display_datasets},i.curDisplayFirstDataset=function(t){return arguments.length?(l.cur_display_first_dataset=t,i):l.cur_display_first_dataset},i.emphasizeYearTicks=function(t){return arguments.length?(l.emphasize_year_ticks=t,i):l.emphasize_year_ticks},i.displayDateRange=function(t){return arguments.length?(l.display_date_range=t,document.getElementById(l.id_div_graph)?i.updateGraph():i):l.display_date_range},i.resizeWidth=function(t){return l.width=t,i.updateGraph()},i.updateGraph=function(t){if(document.getElementById(l.id_div_graph)&&""!=document.getElementById(l.id_div_graph).innerHTML){if(document.getElementById(l.id_div_graph).innerHTML="",t)return i.createGraph(t);r.select("#"+l.id_div_graph).call(i)}return i},i.createGraph=function(t){return r.select("#"+l.id_div_graph).datum(t).call(i),i},i.destroy=function(t){return document.getElementById(l.id_div_graph)&&(document.getElementById(l.id_div_graph).innerHTML=""),document.getElementById(l.id)&&document.getElementById(l.id).remove(),Object.keys(l).forEach(function(t){l[t]=null}),null},l.responsive.function=function(){l.id_div_container&&document.getElementById(l.id_div_graph)&&""!=document.getElementById(l.id_div_graph).innerHTML&&i.resizeWidth(document.getElementById(l.id_div_container).offsetWidth)},l.responsive.enabled&&window.addEventListener("resize",l.responsive.function),i.createGraph(e),i}var e={};return e.generate=function(e,a){return new t(e,a)},e});