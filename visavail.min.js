!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.visavail=e()}(this,function(){"use strict";var t={};function e(t,e){var a,i=window.d3?window.d3:"undefined"!=typeof require?require("d3"):void 0,n=window.moment?window.moment:"undefined"!=typeof require?require("moment"):void 0;if(!i)throw new Error("Require D3.js before visavail script");if(!n)throw new Error("Require moment before visavail script");var r={id:"",id_div_container:"visavail_container",id_div_graph:"example",margin:{top:65,right:60,bottom:20,left:100},width:960,moment_locale:window.navigator.userLanguage||window.navigator.language,reduce_space_wrap:35,line_spacing:35,padding:{top:-49,bottom:0,right:60,left:-100},emphasize_year_ticks:!0,emphasize_month_ticks:!0,ticks_for_graph:6,max_display_datasets:0,cur_display_first_dataset:0,display_date_range:["",""],custom_categories:!1,is_date_only_format:!0,date_in_utc:!1,date_is_descending:!1,show_y_title:!0,y_title_some_unavailability_class:"some_unavailability",y_title_total_unavailability_class:"total_unavailability",y_title_total_availability_class:"total_availability",y_percentage:{enabled:!1,some_unavailability_class:"some_unavailability",total_unavailability_class:"total_unavailability",total_availability_class:"total_availability",percentageFormat:i.format(".2%"),unavailability_percentage:!1,custom_percentage:!1},defined_blocks:!1,y_title_tooltip:{enabled:!1,class:"y-tooltip",type:"right",spacing:{left:15,right:15,top:15,bottom:10},fixed:!1,duration:150},tooltip:{class:"tooltip",height:11,position:"top",left_spacing:0,date_plus_time:!1,only_first_date:!1,duration:150,hover_zoom:{enabled:!1,ratio:.4}},legend:{enabled:!0,line_space:12,rect_width:15,offset:5,x_right_offset:150,has_no_data_text:"No Data available",has_data_text:"Data available",categories:[]},title:{enabled:!0,text:"Data Availability Plot",line_spacing:16},sub_title:{enabled:!0,from_text:"from",to_text:"to",line_spacing:16},sub_chart:{enabled:!1,height:0,animation:!0,margin:{top:20,bottom:0},graph:{enabled:!0,width:7,height:7,line_spacing:7}},icon:{class_has_data:"fas fa-fw fa-check",class_has_no_data:"fas fa-fw fa-times"},zoom:{enabled:!1,onZoom:function(){},onZoomStart:function(){},onZoomEnd:function(){}},onClickBlock:function(){},graph:{type:"bar",width:18,height:18,hover_zoom:5,margin:{top:0,left:0}},responsive:{enabled:!1,onresize:function(){}},fill_gaps:{enabled:!1,category:"0"},custom_time_format:{format_millisecond:".%L",format_second:":%S",format_minute:"%H:%M",format_hour:"%H",format_day:"%a %d",format_week:"%b %d",format_month:"%B",format_year:"%Y"}};function o(t){var e={ddd:"a",dddd:"A",MMM:"b",MMMM:"B",lll:"c",DD:"d",D:"e","YYYY-MM-DD":"F",HH:"H",H:"H",hh:"I",h:"I",DDDD:"j",DDD:"-j",MM:"m",M:"-m",mm:"M",m:"-M",A:"p",a:"P",ss:"S",s:"-S",E:"u",d:"w",WW:"W",ll:"x",LTS:"X",YY:"y",YYYY:"Y",ZZ:"z",z:"Z",SSS:"L","%":"%"};return t.split(/( |\/|:|,|\]|\[|\.)/).map(function(t){return":"==t[0]||"/"==t[0]||" "==t[0]||","==t[0]?t:"["!=t[0]&&"]"!=t[0]?e.hasOwnProperty(t)?"%"+e[t]:t.length>0?"["+t+"]":t:void 0}).join("")}function s(t,e){Object.keys(e).forEach(function(a){a in t&&("object"!=typeof t[a]||Array.isArray(t[a])?typeof e[a]==typeof t[a]&&(t[a]=e[a]):s(t[a],e[a]))})}r.legend.categories.push({class:"rect_has_no_data",text:r.legend.has_no_data_text},{class:"rect_has_data",text:r.legend.has_data_text}),s(r,t),n.locale(r.moment_locale);var l=n().creationData().locale._longDateFormat;function d(t){return(i.timeSecond(t)<t?i.timeFormat(r.custom_time_format.format_millisecond):i.timeMinute(t)<t?i.timeFormat(r.custom_time_format.format_second):i.timeHour(t)<t?i.timeFormat(r.custom_time_format.format_minute):i.timeDay(t)<t?i.timeFormat(r.custom_time_format.format_hour):i.timeMonth(t)<t?i.timeWeek(t)<t?i.timeFormat(r.custom_time_format.format_day):i.timeFormat(r.custom_time_format.format_week):i.timeYear(t)<t?i.timeFormat(r.custom_time_format.format_month):i.timeFormat(r.custom_time_format.format_year))(t)}function c(t){t.each(function(e){i.timeFormatDefaultLocale(r.locale);var o=i.select("#"+r.id_div_container).append("div").attr("class","visavail-tooltip "+r.id).attr("id",r.id).append("div").attr("class",r.tooltip.class+"-"+r.tooltip.position).style("opacity",0),s=i.select("#"+r.id_div_container).append("div").attr("class","visavail-ytitle-tooltip "+r.id).attr("id",r.id).append("div").attr("class",r.y_title_tooltip.class).style("opacity",0),l=r.width-r.margin.left-r.margin.right;r.oldwidth||(r.oldwidth=l);var c,_,p=0;0!==r.max_display_datasets?(c=r.cur_display_first_dataset,_=r.cur_display_first_dataset+r.max_display_datasets>e.length?e.length:r.cur_display_first_dataset+r.max_display_datasets,p=Math.ceil(e.length/r.max_display_datasets)):(c=0,_=e.length),t.attr("data-max-pages",p);var g=_-c,h=r.graph.height*g+r.line_spacing*g-1+r.graph.margin.top;let u=!1;for(let t=0;t<e.length;t++)for(let a=0;a<e[t].data.length;a++)if(Array.isArray(e[t].data[a])){if(u||(console.warn("Deprecation warning: data is not formatted as an object"),u=!0),e[t].data[a].length<2)throw new Error("Data-point array must contain at least 2 values");2===e[t].data[a].length?e[t].data[a]={startDate:e[t].data[a][0],state:e[t].data[a][1]}:e[t].data[a]={startDate:e[t].data[a][0],state:e[t].data[a][1],endDate:e[t].data[a][2]}}r.fill_gaps.enabled&&0!=r.fill_gaps.category&&1!=r.fill_gaps.category&&(r.custom_categories=!0);for(var m=0;m<e.length;m++)if(e[m].description&&(r.tooltip.description=!0),null!=e[m].data[0]&&"endDate"in e[m].data[0]){r.defined_blocks=!0,r.custom_categories||Number.isInteger(e[m].data[0].state)||(r.custom_categories=!0);break}var f=i.timeParse("%Y-%m-%d"),y=i.utcParse("%Y-%m-%d %H:%M:%S"),v=i.utcParse("%Y-%m-%d");if(r.date_in_utc)var b=function(t){return v(t)},x=function(t){return y(t)};else b=function(t){return f(t)},x=function(t){return new Date(t)};var D=new RegExp(/^\d{4}-\d{2}-\d{2}$/),w=new RegExp(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/);performance.now();e.forEach(function(t){t.data.forEach(function(e){if(!(e.startDate instanceof Date))if(w.test(e.startDate))e.startDate=x(e.startDate),r.is_date_only_format=!1;else{if(!D.test(e.startDate))throw new Error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.");e.startDate=b(e.startDate)}if(!(e.endDate instanceof Date))if(r.defined_blocks){if(!e.endDate)throw new Error("Defined block true but dataset not correct");w.test(e.endDate)?e.endDate=x(e.endDate):D.test(e.endDate)?e.endDate=b(e.endDate):(e.endDate=e.startDate,"rhombus"!=r.graph.type&&console.error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'."))}else e.endDate=i.timeSecond.offset(e.startDate,t.interval_s)})});var S=n().year(2999).toDate(),M=n().year(0).toDate();if(e.forEach(function(t,a){var i=[],n=t.data.length;t.data.forEach(function(t,e){t.endDate>=M&&(M=t.endDate),t.startDate<=S&&(S=t.startDate),0!==e&&e<n?t.state===i[i.length-1].state&&t.tooltip_html===i[i.length-1].tooltip_html?r.defined_blocks?i[i.length-1].endDate.getTime()===t.startDate.getTime()?i[i.length-1].endDate=t.endDate:i.push(t):r.fill_gaps.enabled?i[i.length-1].endDate.getTime()>=t.startDate.getTime()?i[i.length-1].endDate=t.endDate:(i.push({startDate:i[i.length-1].endDate,endDate:t.startDate,state:r.fill_gaps.category}),i.push(t)):i[i.length-1].endDate=t.endDate:(r.defined_blocks||(r.fill_gaps.enabled&&i[i.length-1].endDate.getTime()<t.startDate.getTime()?i.push({startDate:i[i.length-1].endDate,endDate:t.startDate,state:r.fill_gaps.category}):i[i.length-1].endDate=t.startDate),i.push(t)):0===e&&(t.length<3&&(t.endDate=t.startDate),i.push(t))}),e[a].disp_data=i}),r.display_date_range&&(r.display_date_range[0]||r.display_date_range[1])){if(r.display_date_range[0])if(r.display_date_range[0]instanceof Date)S=r.date_in_utc?n.utc(r.display_date_range[0]).toDate():r.display_date_range[0];else{if(D.test(r.display_date_range[0]))r.display_date_range[0]=b(r.display_date_range[0]);else{if(!w.test(r.display_date_range[0]))throw new Error("Option of Display range Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.");r.display_date_range[0]=x(r.display_date_range[0])}S=r.display_date_range[0]}if(r.display_date_range[1])if(r.display_date_range[1]instanceof Date)M=r.date_in_utc?n.utc(r.display_date_range[1]).toDate():r.display_date_range[1];else{if(D.test(r.display_date_range[1]))r.display_date_range[1]=b(r.display_date_range[1]);else{if(!w.test(r.display_date_range[1]))throw new Error("Option of Display range Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.");r.display_date_range[1]=x(r.display_date_range[1])}M=r.display_date_range[1]}}r.y_percentage.enabled&&!r.y_percentage.custom_percentage&&e.forEach(function(t,a){e[a].timeup_ms=0,e[a].timedown_ms=0,r.custom_categories?t.disp_data.forEach(function(i){i.state===t.category_percentage?e[a].timeup_ms+=i.endDate.getTime()-i.startDate.getTime():e[a].timedown_ms+=i.endDate.getTime()-i.startDate.getTime()}):t.disp_data.forEach(function(t){t.state?e[a].timeup_ms+=t.endDate.getTime()-t.startDate.getTime():e[a].timedown_ms+=t.endDate.getTime()-t.startDate.getTime()})});var E=i.scaleTime().domain([S,M]).range([0,l]),Y=i.scaleTime().domain([S,M]).range([0,l]);r.date_is_descending&&(E.domain([M,S]),Y.domain([M,S])),r.xScale=E;var k=i.axisTop(r.xScale).scale(r.xScale).ticks(r.ticks_for_graph).tickFormat(d),T=i.axisBottom(Y).scale(Y).ticks(r.ticks_for_graph).tickFormat(d),z=i.select(this).append("svg").attr("width",l+r.margin.left+r.margin.right).attr("height",h+r.margin.top+r.margin.bottom+r.sub_chart.height+r.sub_chart.margin.top+r.sub_chart.margin.bottom).append("g").attr("transform","translate("+r.margin.left+","+r.margin.top+")");z.append("g").attr("id","g_title");const A=z.append("g").attr("id","g_graph").attr("transform","translate("+r.graph.margin.left+","+r.graph.margin.top+")");function L(){for(var t=i.select(this),e=t.node().getComputedTextLength(),a=t.text();e>-1*r.padding.left+r.reduce_space_wrap&&a.length>0;)a=a.slice(0,-1),t.text(a+"..."),e=t.node().getComputedTextLength()}if(A.append("g").attr("id","g_axis"),A.append("g").attr("id","g_data").append("rect").attr("id","zoom").attr("width",l).attr("height",h).attr("fill-opacity",0).attr("x",0).attr("y",0),A.append("g").attr("id","g_axis_text"),A.append("g").attr("id","g_title"),r.zoomed=i.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[l,r.height]]).extent([[0,0],[l,r.height]]).on("start",function(){var t=i.event;t.sourceEvent&&"brush"===t.sourceEvent.type||(t.sourceEvent&&"touchstart"===t.sourceEvent.type&&t.sourceEvent.cancelable&&(event.preventDefault(),event.stopImmediatePropagation()),(t.transform.k||t.transform.x)&&(a=t,r.zoom.onZoomStart.call(this,t)))}).on("zoom",function(){var t=i.event;if(t.sourceEvent&&"brush"===t.sourceEvent.type&&!r.sub_chart.animation)return;if(t&&"zoom"!==t.type)return;(t.transform.k||t.transform.x)&&(r.xScale=t.transform.rescaleX(E),t.sourceEvent&&"touchmove"==t.sourceEvent?O(t.sourceEvent.touches[0].layerX,t.sourceEvent.touches[0].layerY):t.sourceEvent&&O(t.sourceEvent.layerX,t.sourceEvent.layerY),P.selectAll("rect").attr("x",function(t){return R(t,r.graph.width,r.xScale,0)}).attr("width",function(t){return $(t,r.graph.width,r.xScale,0)}).attr("transform",function(t){return J(t,r.xScale,r.graph.height,r.line_spacing,0)}),z.select(".xAxis").call(k.scale(r.xScale)),z.select("#vGrid").selectAll("line").remove(),N(r.xScale),G(r.xScale),r.sub_chart.enabled&&z.select("#g_brush").call(X.move,r.xScale.range().map(t.transform.invertX,t.transform)),r.zoom.onZoom.call(this,r.xScale.domain()))}).on("end",function(){var t=i.event;null!=t&&(t.sourceEvent&&"brush"===t.sourceEvent.type||(t.sourceEvent&&"touchend"===t.sourceEvent.type&&t.sourceEvent.cancelable&&(event.preventDefault(),event.stopImmediatePropagation()),t.transform.k||t.transform.x?(r.scale=i.zoomTransform(z.select("#g_data").node()),r.zoom.onZoomEnd.call(this,r.xScale.domain())):(t.transform.k=a.transform.k,t.transform.x=a.transform.x,r.scale=i.zoomIdentity.translate(t.transform.x,t.transform.y).scale(t.transform.k),r.zoom.onZoomEnd.call(this,r.xScale.domain()))))}),r.zoom.enabled&&z.select("#g_data").call(r.zoomed).attr("cursor","ew-resize"),r.show_y_title){var H=z.select("#g_axis_text").append("g").attr("id","yAxis");if(H.selectAll("text").data(e.slice(c,_)).enter().append("g").attr("id",function(t,e){return e}),H.selectAll("g").append("text").attr("x",r.padding.left).attr("y",function(t,e){return(r.line_spacing+r.graph.height)*e+r.line_spacing+r.graph.height/2}).attr("dy","0.5ex").text(function(t){return t.measure||t.measure_html}).each(L).attr("class",function(t){var e="ytitle";return null!=t.measure_url&&(e+=" link"),r.y_percentage.enabled&&!r.y_percentage.custom_percentage&&(0==t.timedown_ms?e+=" "+r.y_title_total_availability_class:0==t.timeup_ms?e+=" "+r.y_title_total_unavailability_class:e+=" "+r.y_title_some_unavailability_class),e}).on("click",function(t){return null!=t.measure_url?window.open(t.measure_url):null}),H.selectAll("g").append("circle").attr("class",function(t){return"ytitle_icon_background "+((t.icon||"").background_class||"")}).attr("cx",function(t){return t.icon&&t.icon.width?r.padding.left-t.icon.width/2-((t.icon.padding||0).right||0)-(t.icon.padding_right||0):0}).attr("cy",function(t,e){return t.icon&&t.icon.height?(r.line_spacing+r.graph.height)*e+r.line_spacing+r.graph.height/2:0}).attr("r",function(t){return t.icon&&t.icon.width?t.icon.width/2:0}),H.selectAll("g").append("image").attr("class",function(t){return"ytitle_icon_image "+((t.icon||"").image_class||"")}).attr("xlink:href",function(t){return t.icon&&t.icon.url?t.icon.url:""}).attr("x",function(t){return t.icon&&t.icon.width?r.padding.left-t.icon.width-((t.icon.padding||0).right||0)-(t.icon.padding_right||0):0}).attr("y",function(t,e){return t.icon&&t.icon.height?(r.line_spacing+r.graph.height)*e-t.icon.height/2+r.line_spacing+r.graph.height/2:0}).attr("width",function(t){return t.icon&&t.icon.width?t.icon.width:0}).attr("height",function(t){return t.icon&&t.icon.height?t.icon.height:0}),r.y_title_tooltip.enabled){function I(t,e,a,n){if(r.y_title_tooltip.enabled){var o=t.getCTM().translate(t.getAttribute("x"),t.getAttribute("y"));s.transition().duration(r.y_title_tooltip.duration).style("opacity",1),s.html(function(){return a.measure_description||""}),"right"==r.y_title_tooltip.type&&s.style("left",function(){return r.y_title_tooltip.fixed?-1*r.padding.left+"px":r.y_title_tooltip.spacing.right+i.select(t).node().getComputedTextLength()+"px"}).classed(r.y_title_tooltip.type,!0).style("top",o.f-(document.getElementsByClassName(r.y_title_tooltip.class)[0].offsetHeight+(r.line_spacing+r.graph.height)*n)/2+"px"),"top"==r.y_title_tooltip.type&&s.style("left","0px").style("top",o.f-(document.getElementsByClassName(r.y_title_tooltip.class)[0].offsetHeight+r.y_title_tooltip.spacing.top)+"px").classed(r.y_title_tooltip.type,!0),"bottom"==r.y_title_tooltip.type&&s.style("left","0px").style("top",o.f+r.y_title_tooltip.spacing.bottom+"px").classed(r.y_title_tooltip.type,!0)}}function B(){s.transition().duration(r.y_title_tooltip.duration).style("opacity",0)}H.selectAll("g").selectAll("text").on("mouseover",function(t,a){I(this,e,t,a)}).on("touchstart",function(t,e){I(this,t,e)}).on("mouseout",function(){B()}).on("touchleave",function(){B()}).on("touchcancel",function(){B()})}else H.selectAll("g").append("title").text(function(t){return t.measure_description||t.measure})}if(r.y_percentage.enabled){var F=z.select("#g_axis_text").append("g").attr("id","yPercentage");F.selectAll("text").data(e.slice(c,_)).enter().append("g").attr("id",function(t,e){return e}),F.selectAll("g").append("text").attr("x",l).attr("dx",r.padding.right).attr("y",function(t,e){return(r.line_spacing+r.graph.height)*e+r.line_spacing+r.graph.height/2}).attr("dy","0.5ex").attr("text-anchor","end").text(function(t){return!r.custom_categories&&r.y_percentage.unavailability_percentage?r.y_percentage.percentageFormat(t.timedown_ms/(t.timedown_ms+t.timeup_ms)):r.y_percentage.custom_percentage?(t.percentage||"").measure||"":r.y_percentage.percentageFormat(t.timeup_ms/(t.timeup_ms+t.timedown_ms))}).each(L).attr("class",function(t){var e="ypercentage";return r.y_percentage.custom_percentage?r.y_percentage.custom_percentage&&(e+=" "+(t.percentage||"").class||""):0==t.timedown_ms?e+=" "+r.y_percentage.total_availability_class:0==t.timeup_ms?e+=" "+r.y_percentage.total_unavailability_class:e+=" "+r.y_percentage.some_unavailability_class,e})}function N(t){z.select("#vGrid").selectAll("line.vert_grid").data(t.ticks(r.ticks_for_graph)).enter().append("line").attr("x1",function(e){return t(e)}).attr("x2",function(e){return t(e)}).attr("y1",0).attr("y2",r.graph.height*g+r.line_spacing*g-1+r.margin.bottom).attr("class","vert_grid")}z.select("#g_axis").append("g").attr("id","vGrid"),g&&N(r.xScale),z.select("#g_axis").append("g").attr("id","hGrid").selectAll("line.horz_grid").data(e).enter().append("line").attr("x1",0).attr("x2",l).attr("y1",function(t,e){return(r.line_spacing+r.graph.height)*e+r.line_spacing+r.graph.height/2}).attr("y2",function(t,e){return(r.line_spacing+r.graph.height)*e+r.line_spacing+r.graph.height/2}).attr("class","horz_grid"),g&&z.select("#g_axis").append("g").attr("class","xAxis").call(k);var P=z.select("#g_data").selectAll(".g_data").data(e.slice(c,_)).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(r.line_spacing+r.graph.height)*e+")"}).attr("cursor","pointer").attr("class","dataset");function O(t,e,a){o.style("left",function(){return r.width<t+o.property("offsetWidth")+r.tooltip.left_spacing?t-o.property("offsetWidth")-r.tooltip.left_spacing+"px":t+r.tooltip.left_spacing+"px"}),"top"===r.tooltip.position&&(r.width<t+o.property("offsetWidth")+r.tooltip.left_spacing?o.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):o.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===r.tooltip.position&&(document.getElementById(r.id_div_graph).offsetHeight<e+o.property("offsetHeight")?o.style("top",document.getElementById(r.id_div_graph).offsetHeight-o.property("offsetHeight")+"px"):o.style("top",e+"px"))}function W(t){return+t==+new Date(t.getFullYear(),0,1,0,0,0)}function C(t){return+t==+new Date(t.getFullYear(),t.getMonth(),1,0,0,0)}function G(t){var e=t.ticks(r.ticks_for_graph),a=e.map(W),n=e.map(C);r.emphasize_year_ticks&&!a.every(function(t){return!0===t})&&n.every(function(t){return!0===t})&&(i.selectAll("#"+r.id_div_graph+" g.tick").each(function(t,e){a[e]&&i.select(this).attr("class","tick x_tick_emph")}),i.selectAll("#"+r.id_div_graph+" .vert_grid").each(function(t,e){a[e]&&i.select(this).attr("class","vert_grid vert_grid_emph")})),r.emphasize_month_ticks&&!n.every(function(t){return!0===t})&&(i.selectAll("#"+r.id_div_graph+" g.tick").each(function(t,e){n[e]&&i.select(this).attr("class","tick x_tick_emph")}),i.selectAll("#"+r.id_div_graph+" g.vert_grid").each(function(t,e){n[e]&&i.select(this).attr("class","vert_grid vert_grid_emph")}))}if(P.selectAll("rect").data(function(t){return t.disp_data}).enter().append("rect").attr("x",function(t){return R(t,r.graph.width,r.xScale,0)}).attr("width",function(t){return $(t,r.graph.width,r.xScale,0)}).attr("y",r.line_spacing).attr("height",r.graph.height).attr("transform",function(t){return J(t,r.xScale,r.graph.height,r.line_spacing,0)}).attr("rx",function(t){return K()}).attr("ry",function(t){return K()}).attr("class",function(t){if(!r.custom_categories)return 1===t.state?"rect_has_data":"rect_has_no_data";var a=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];return a&&a.categories?a.categories[t.state].class:void 0}).on("mouseover",function(t,a){!function(t,e,a,s,l,d){r.tooltip.hover_zoom.enabled&&i.select(t).transition().duration(r.tooltip.duration).attr("x",function(t){return"rhombus"==r.graph.type||"circle"==r.graph.type?R(t,r.graph.width,r.xScale,r.line_spacing*r.tooltip.hover_zoom.ratio*2):R(t,r.graph.width,r.xScale,0)}).attr("width",function(t){return"rhombus"==r.graph.type||"circle"==r.graph.type?$(t,r.graph.width,r.xScale,r.line_spacing*r.tooltip.hover_zoom.ratio):$(t,r.graph.width,r.xScale,0)}).attr("y",r.line_spacing-r.line_spacing*r.tooltip.hover_zoom.ratio/2).attr("height",r.graph.height+r.line_spacing*r.tooltip.hover_zoom.ratio).attr("transform",function(t){return J(t,r.xScale,r.graph.height,r.line_spacing,r.line_spacing*r.tooltip.hover_zoom.ratio)});var c=t.getCTM().translate(t.getAttribute("x"),t.getAttribute("y"));o.transition().duration(r.tooltip.duration).style("opacity",1),o.html(function(){var t,a="";return a=r.custom_categories?(t=e.filter(function(t){return t.disp_data.indexOf(l)>=0})[0])&&t.categories[l.state].tooltip_html?t.categories[l.state].tooltip_html:"&nbsp;"+l.state+"&nbsp;":1===l.state?'<i class=" '+r.icon.class_has_data+' tooltip_has_data"></i>':'<i class=" '+r.icon.class_has_no_data+' tooltip_has_no_data"></i>',r.tooltip.description&&(t=e.filter(function(t){return t.disp_data.indexOf(l)>=0})[0])&&t.description&&t.description[d]&&(a+=" "+t.description[d]+" "),r.is_date_only_format&&!r.tooltip.date_plus_time?l.endDate>i.timeSecond.offset(l.startDate,86400)&&!r.tooltip.only_first_date?r.date_is_descending?a+=n(l.endDate).format("l")+" - "+n(l.startDate).format("l"):a+=n(l.startDate).format("l")+" - "+n(l.endDate).format("l"):r.date_is_descending?a+=n(l.endDate).format("l"):a+=n(l.startDate).format("l"):r.tooltip.only_first_date?l.endDate>i.timeSecond.offset(l.startDate,86400)||r.tooltip.date_plus_time?r.date_is_descending?a+=n(l.endDate).format("l")+" "+n(l.endDate).format("LTS"):a+=n(l.startDate).format("l")+" "+n(l.startDate).format("LTS"):r.date_is_descending?a+=n(l.endDate).format("LTS"):a+=n(l.startDate).format("LTS"):l.endDate>i.timeSecond.offset(l.startDate,86400)||r.tooltip.date_plus_time?r.date_is_descending?a+=n(l.endDate).format("l")+" "+n(l.endDate).format("LTS")+" - "+n(l.startDate).format("l")+" "+n(l.startDate).format("LTS"):a+=n(l.startDate).format("l")+" "+n(l.startDate).format("LTS")+" - "+n(l.endDate).format("l")+" "+n(l.endDate).format("LTS"):r.date_is_descending?a+=n(l.endDate).format("LTS")+" - "+n(l.startDate).format("LTS"):a+=n(l.startDate).format("LTS")+" - "+n(l.endDate).format("LTS"),"tooltip_html"in l&&(a+=" "+l.tooltip_html+" "),a}).style("left",function(){return r.width<a+o.property("offsetWidth")+r.tooltip.left_spacing?a-o.property("offsetWidth")-r.tooltip.left_spacing+"px":a+r.tooltip.left_spacing+"px"}),"top"===r.tooltip.position&&(o.style("top",function(){return r.tooltip.hover_zoom.enabled?window.pageYOffset+c.f-r.tooltip.height-r.tooltip.hover_zoom.ratio*r.line_spacing+"px":c.f-r.tooltip.height+"px"}).style("height",function(){return r.tooltip.hover_zoom.enabled?r.tooltip.hover_zoom.ratio*r.line_spacing+r.graph.height+r.tooltip.height+"px":r.graph.height+r.tooltip.height+"px"}),r.width<a+o.property("offsetWidth")+r.tooltip.left_spacing?o.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):o.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none"));"overlay"===r.tooltip.position&&o.style("top",s+"px")}(this,e,i.event.layerX,i.event.layerY,t,a)}).on("mouseout",function(){!function(t){r.tooltip.hover_zoom.enabled&&i.select(t).transition().duration(r.tooltip.duration).attr("x",function(t){return R(t,r.graph.width,r.xScale,0)}).attr("width",function(t){return $(t,r.graph.width,r.xScale,0)}).attr("y",r.line_spacing).attr("height",r.graph.height).attr("transform",function(t){return J(t,r.xScale,r.graph.height,r.line_spacing,0)});o.transition().duration(r.tooltip.duration).style("opacity",0)}(this)}).on("click",function(t,e){r.onClickBlock.call(this,t,e)}).on("mousemove",function(){O(i.event.layerX,i.event.layerY,this)}),G(E),r.title.enabled&&z.select("#g_title").append("text").attr("x",r.padding.left).attr("y",r.padding.top).text(r.title.text).attr("class","heading"),r.sub_title.enabled){var Z="";g&&(Z=r.is_date_only_format?r.sub_title.from_text+" "+n(S).format("MMMM Y")+" "+r.sub_title.to_text+" "+n(M).format("MMMM Y"):r.sub_title.from_text+" "+n(S).format("l")+" "+n(S).format("LTS")+" "+r.sub_title.to_text+" "+n(M).format("l")+" "+n(M).format("LTS")),z.select("#g_title").append("text").attr("x",r.padding.left).attr("y",r.padding.top+r.title.line_spacing).text(Z).attr("class","subheading")}if(r.legend.enabled){var j=z.select("#g_title").append("g").attr("id","g_legend").attr("transform","translate(0,-12)");for(let t=0;t<r.legend.categories.length;++t){const e=r.legend.categories[t];j.append("rect").attr("x",l+r.margin.right-r.legend.x_right_offset).attr("y",r.padding.top+t*(r.legend.rect_width+r.legend.offset)).attr("height",r.legend.rect_width).attr("width",r.legend.rect_width).attr("class",e.class),j.append("text").attr("x",l+r.margin.right-r.legend.x_right_offset+4*r.legend.rect_width/3).attr("y",r.padding.top+t*(r.legend.rect_width+r.legend.offset)+3*r.legend.line_space/4).text(e.text).attr("dy","0.5ex").attr("class","legend")}}if(r.sub_chart.enabled){var X=i.brushX().extent([[0,0],[l,r.sub_chart.height]]).on("brush end",function(){if(i.event&&i.event.sourceEvent&&"zoom"===i.event.sourceEvent.type)return;var t=i.event.selection||Y.range();z.select("#g_data").call(r.zoomed.transform,i.zoomIdentity.scale(l/(t[1]-t[0])).translate(-t[0],0))});z.append("g").attr("id","g_sub").append("g").attr("class","subchart-xAxis").attr("transform","translate( 0, "+(r.sub_chart.margin.top+r.sub_chart.height+h)+")").call(T).append("g"),z.selectAll("#g_sub").append("g").attr("id","g_sub_data"),r.sub_chart.graph.enabled&&z.selectAll("#g_sub_data").selectAll(".g_sub_data").data(e.slice(c,_)).enter().append("g").attr("transform",function(t,e){return"translate( 0, "+((r.sub_chart.graph.line_spacing+r.sub_chart.graph.height)*e+r.sub_chart.margin.top+h)+")"}).selectAll("rect").data(function(t){return t.disp_data}).enter().append("rect").attr("x",function(t){return R(t,r.sub_chart.graph.width,Y,0)}).attr("width",function(t){return $(t,r.sub_chart.graph.width,Y,0)}).attr("y",r.sub_chart.graph.line_spacing).attr("height",r.sub_chart.graph.height).attr("transform",function(t){return J(t,Y,r.sub_chart.graph.height,r.sub_chart.graph.line_spacing,0)}).attr("rx",function(t){return K()}).attr("ry",function(t){return K()}).attr("class",function(t){if(!r.custom_categories)return 1===t.state?"rect_has_data":"rect_has_no_data";var a=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];return a&&a.categories?a.categories[t.state].class:void 0}),z.select("#g_sub").append("g").attr("id","g_brush").attr("class","brush").attr("width",l).attr("transform","translate( 0, "+(r.sub_chart.margin.top+h)+")").call(X)}if(r.scale){var q=(-l*r.scale.k*(-1*r.scale.x/(r.oldwidth*r.scale.k))-r.scale.x)/r.scale.k;z.select("#g_data").call(r.zoomed.transform,r.scale.translate(q,0)),r.oldwidth=l}else r.sub_chart.enabled&&z.select("#g_brush").call(X.move,E.range());function R(t,e,a,i){var n=a(t.startDate)-i;return r.date_is_descending&&(n=a(t.endDate)-i),isNaN(n)||n<=0||n+i>l?0-i/2:"rhombus"==r.graph.type||"circle"==r.graph.type?a(t.startDate)-e/2:n}function $(t,e,a,i){var n=a(t.startDate)-i,o=a(t.endDate)+i;return r.date_is_descending&&(n=a(t.endDate)-i,o=a(t.startDate)+i),isNaN(n)||isNaN(o)||!r.date_is_descending&&o-n<0||o<=0&&n<=0?0:r.date_is_descending&&o-n<0?-1*(o-n):"rhombus"==r.graph.type||"circle"==r.graph.type?n+i<0?0-i:e+i:n<0&&o>0?o>l?l:o-i:o<0&&n>0?n>l?l:n-i:o>l?l-n<0?0:l-n+i:o-n}function J(t,e,a,i,n){var o=e(t.startDate);return("rhombus"==r.graph.type||"circle"==r.graph.type)&&o>0?"rotate(45 "+o+"  "+(a/2+i-n)+")":("rhombus"==r.graph.type||"circle"==r.graph.type)&&o<=0?"rotate(45 0 "+(a/2+i-n)+")":void 0}function K(){return"circle"==r.graph.type?2e5:0}})}return r.locale={dateTime:o(l.LLLL),date:o(l.L),time:o(l.LTS),periods:["AM","PM"],days:n.weekdays(),shortDays:n.weekdaysShort(),months:n.months(),shortMonths:n.monthsShort()},r.custom_time_format||(r.custom_time_format={format_millisecond:o("SSS"),format_second:o(":ss"),format_minute:o(l.LT),format_hour:o(l.LT.substring(0,1)+(l.LTS.indexOf("a")>-1||l.LTS.indexOf("A")>-1?" "+l.LT.slice(-1):"")),format_day:o("ddd DD"),format_week:o("MMM DD"),format_month:o("MMMM"),format_year:o("YYYY")}),t.hasOwnProperty("width")||(r.width=document.getElementById(r.id_div_graph).offsetWidth),r.id="visavail-"+Math.random().toString(36).substring(7),c.maxDisplayDatasets=function(t){return arguments.length?(r.max_display_datasets=t,c):r.max_display_datasets},c.displayDateRange=function(t,e){return arguments.length?(r.display_date_range=t,document.getElementById(r.id_div_graph)?c.updateGraph(null,e):c):r.display_date_range},c.updateOptions=function(t){return c.updateGraph(t)},c.resizeWidth=function(t){return r.width=t,c.updateGraph()},c.updateGraph=function(e,a){if(document.getElementById(r.id_div_graph)&&""!=document.getElementById(r.id_div_graph).innerHTML){if(document.getElementById(r.id_div_graph).innerHTML="",document.getElementById(r.id)&&function(t){for(var e=document.getElementsByClassName(t);e.length>0;)e[0].parentNode.removeChild(e[0])}(r.id),e&&s(r,t),a)return c.createGraph(a);i.select("#"+r.id_div_graph).call(c)}return c},c.createGraph=function(t){return i.select("#"+r.id_div_graph).datum(t).call(c),c},c.destroy=function(t){return document.getElementById(r.id_div_graph)&&(document.getElementById(r.id_div_graph).innerHTML=""),document.getElementById(r.id)&&document.getElementById(r.id).remove(),Object.keys(r).forEach(function(t){r[t]=null}),null},r.responsive.function=function(){r.id_div_container&&document.getElementById(r.id_div_graph)&&""!=document.getElementById(r.id_div_graph).innerHTML&&c.resizeWidth(document.getElementById(r.id_div_graph).offsetWidth)},r.responsive.enabled&&window.addEventListener("resize",r.responsive.function),c.createGraph(e),c}return Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Element.prototype.remove=Element.prototype.remove||function(){this.parentNode&&this.parentNode.removeChild(this)},t.generate=function(t,a){return new e(t,a)},t});