(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.visavail=e()})(this,function(){function t(t,e){function a(t){return(n.timeSecond(t)<t?n.timeFormat(l.customTimeFormat.formatMillisecond):n.timeMinute(t)<t?n.timeFormat(l.customTimeFormat.formatSecond):n.timeHour(t)<t?n.timeFormat(l.customTimeFormat.formatMinute):n.timeDay(t)<t?n.timeFormat(l.customTimeFormat.formatHour):n.timeMonth(t)<t?n.timeWeek(t)<t?n.timeFormat(l.customTimeFormat.formatDay):n.timeFormat(l.customTimeFormat.formatWeek):n.timeYear(t)<t?n.timeFormat(l.customTimeFormat.formatMonth):n.timeFormat(l.customTimeFormat.formatYear))(t)}function r(t){var e={ddd:"a",dddd:"A",MMM:"b",MMMM:"B",lll:"c",DD:"d",D:"e","YYYY-MM-DD":"F",HH:"H",H:"k",hh:"I",h:"l",DDDD:"j",DDD:"-j",MM:"m",M:"-m",mm:"M",m:"-M",A:"p",a:"P",ss:"S",s:"-S",E:"u",d:"w",WW:"W",ll:"x",LTS:"X",YY:"y",YYYY:"Y",ZZ:"z",z:"Z",SSS:"f","%":"%"},a=t.split(/( |\/|:)/),r=a.map(function(t){return":"==t[0]||"/"==t[0]||" "==t[0]?t:e.hasOwnProperty(t)?"%"+e[t]:t.length>0?"["+t+"]":t}).join("");return r}function i(t){t.each(function(e){function r(t){E.select("#vGrid").selectAll("line.vert_grid").data(t.ticks()).enter().append("line").attr("x1",function(e){return t(e)}).attr("x2",function(e){return t(e)}).attr("y1",0).attr("y2",l.graph.height*x+l.lineSpacing*x-1+l.paddingBottom).attr("class","vert_grid")}function i(t){return+t===+new Date(t.getFullYear(),0,1,0,0,0)}function s(t){return+t===+new Date(t.getFullYear(),t.getMonth(),1,0,0,0)}function d(t){var e=t.ticks(),a=e.map(i),r=e.map(s);l.emphasizeYearTicks&&!a.every(function(t){return t===!0})&&r.every(function(t){return t===!0})&&(n.selectAll("#"+l.id_div_graph+" g.tick").each(function(t,e){a[e]&&n.select(this).attr("class","tick x_tick_emph")}),n.selectAll("#"+l.id_div_graph+" .vert_grid").each(function(t,e){a[e]&&n.select(this).attr("class","vert_grid vert_grid_emph")})),l.emphasizeMonthTicks&&!r.every(function(t){return t===!0})&&(n.selectAll("#"+l.id_div_graph+" g.tick").each(function(t,e){r[e]&&n.select(this).attr("class","tick x_tick_emph")}),n.selectAll("#"+l.id_div_graph+" g.vert_grid").each(function(t,e){r[e]&&n.select(this).attr("class","vert_grid vert_grid_emph")}))}function p(){null==n.event.sourceEvent&&"zoom"!==n.event.type||(n.event.transform.k||n.event.transform.x)&&(l.xScale=n.event.transform.rescaleX(z),null!==n.event.sourceEvent&&"zoom"==n.event.type&&c.style("left",n.event.pageX+"px"),H.selectAll("rect").attr("x",function(t){return g(t,l.xScale)}).attr("width",function(t){return h(t,l.xScale)}).attr("transform",function(t){return m(t,l.xScale)}),E.select(".xAxis").call(F.scale(l.xScale)),E.select("#vGrid").selectAll("line").remove(),r(l.xScale),d(l.xScale),l.zoom.onzoom.call(this,l.xScale.domain()))}function g(t,e){return e(t[0])<0?0:"rhombus"==l.graph.type||"circle"==l.graph.type?e(t[0])-l.graph.width/2:e(t[0])}function h(t,e){return e(t[2])-e(t[0])<0||e(t[2])<0&&e(t[1])<0?0:"rhombus"==l.graph.type||"circle"==l.graph.type?e(t[0])<0?0:l.graph.width:e(t[0])<0&&e(t[2])>0?e(t[2]):e(t[2])<0&&e(t[1])>0?e(t[1]):e(t[2])-e(t[0])}function m(t,e){return("rhombus"==l.graph.type||"circle"==l.graph.type)&&e(t[0])>0?"rotate(45 "+e(t[0])+"  "+(l.graph.height/2+l.lineSpacing)+")":("rhombus"==l.graph.type||"circle"==l.graph.type)&&e(t[0])<=0?"rotate(45 0 "+(l.graph.height/2+l.lineSpacing)+")":void 0}function u(){return"circle"==l.graph.type?2e5:0}n.timeFormatDefaultLocale(l.locale);var f,_,y=l.width-l.margin.left-l.margin.right,v=0;0!==l.maxDisplayDatasets?(f=l.curDisplayFirstDataset,_=l.curDisplayFirstDataset+l.maxDisplayDatasets>e.length?e.length:l.curDisplayFirstDataset+l.maxDisplayDatasets,v=Math.ceil(e.length/l.maxDisplayDatasets)):(f=0,_=e.length),t.attr("data-max-pages",v);for(var x=_-f,D=l.graph.height*x+l.lineSpacing*x-1,b=0;b<e.length;b++)if(e[b].description&&(l.tooltip.description=!0),null!=e[b].data[0]&&3==e[b].data[0].length){l.definedBlocks=!0,Number.isInteger(e[b].data[0][1])||(l.custom_categories=!0);break}if(l.date_in_utc)var w=function(t){return o.utc(t).toDate()},M=function(t){return o.utc(t).toDate()};else var w=function(t){return o(t).toDate()},M=function(t){return o(t).toDate()};var S=new RegExp(/^\d{4}-\d{2}-\d{2}$/),Y=new RegExp(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/);e.forEach(function(t){t.data.forEach(function(e){if(!(e[0]instanceof Date)){if(S.test(e[0]))e[0]=w(e[0]);else{if(!Y.test(e[0]))throw new Error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.");e[0]=M(e[0]),l.isDateOnlyFormat=!1}l.definedBlocks?S.test(e[2])?e[2]=w(e[2]):Y.test(e[2])?e[2]=M(e[2]):(e[2]=e[0],"rhombus"!=l.graph.type&&console.error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.")):e[2]=n.timeSecond.offset(e[0],t.interval_s)}})});var T=o().year(2999),k=o().year(0);e.forEach(function(t,a){var r=[],i=t.data.length;t.data.forEach(function(t,e){o(t[2]).isSameOrAfter(k)&&(k=t[2]),o(t[0]).isSameOrBefore(T)&&(T=t[0]),0!==e&&e<i?t[1]===r[r.length-1][1]?l.definedBlocks?r[r.length-1][2].getTime()===t[0].getTime()?(r[r.length-1][2]=t[2],r[r.length-1][3]=1):r.push(t):(r[r.length-1][2]=t[2],r[r.length-1][3]=1):(t[3]=0,l.definedBlocks||(r[r.length-1][2]=t[0]),r.push(t)):0===e&&(t[3]=0,r.push(t))}),e[a].disp_data=r}),0!=l.display_date_range[0]&&(T=o(l.display_date_range[0])),0!=l.display_date_range[1]&&(k=o(l.display_date_range[1]));var z=n.scaleTime().domain([T,k]).range([0,y]),F=n.axisTop(z).scale(z).tickFormat(a),E=n.select(this).append("svg").attr("width",y+l.margin.left+l.margin.right).attr("height",D+l.margin.top+l.margin.bottom).append("g").attr("transform","translate("+l.margin.left+","+l.margin.top+")");if(E.append("g").attr("id","g_title"),E.append("g").attr("id","g_axis"),l.zoom.enabled&&(l.zoomed=n.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[y,l.height]]).extent([[0,0],[y,l.height]]).on("zoom",p).on("start",function(){var t=n.event;t&&"brush"===t.type||(startEvent=t,l.zoom.onzoomstart.call(this,t))}).on("end",function(){var t=n.event.sourceEvent;t&&"brush"===t.type||t&&startEvent.clientX===t.clientX&&startEvent.clientY===t.clientY||(l.scale=n.zoomTransform(E.node()),l.zoom.onzoomend.call(this,z.domain()))}),E.append("rect").attr("id","zoom").attr("width",y).attr("height",D).attr("fill-opacity",0).attr("cursor","ew-resize").attr("x",0).attr("y",0),E.call(l.zoomed)),E.append("g").attr("id","g_data"),l.ytitle){var L=E.select("#g_axis").append("g").attr("id","yAxis").selectAll("text").data(e.slice(f,_)).enter();L.append("foreignObject").attr("x",l.paddingLeft).attr("y",l.lineSpacing).attr("transform",function(t,e){return"translate(0,"+(l.lineSpacing+l.graph.height)*e+")"}).attr("width",-1*l.paddingLeft).attr("height",l.graph.height).attr("class",function(t){var e="ytitle";return null!=t.measure_url&&(e+=" link"),e}).html(function(t){return null!=t.measure_html?t.measure_html:t.measure}).on("click",function(t){return null!=t.measure_url?window.open(t.measure_url):null})}E.select("#g_axis").append("g").attr("id","vGrid"),x&&r(z),E.select("#g_axis").append("g").attr("id","hGrid").selectAll("line.horz_grid").data(e).enter().append("line").attr("x1",0).attr("x2",y).attr("y1",function(t,e){return(l.lineSpacing+l.graph.height)*e+l.lineSpacing+l.graph.height/2}).attr("y2",function(t,e){return(l.lineSpacing+l.graph.height)*e+l.lineSpacing+l.graph.height/2}).attr("class","horz_grid"),x&&E.select("#g_axis").append("g").attr("class","xAxis").call(F);var H=E.select("#g_data").selectAll(".g_data").data(e.slice(f,_)).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(l.lineSpacing+l.graph.height)*e+")"}).attr("cursor","pointer").attr("class","dataset");if(H.selectAll("rect").data(function(t){return t.disp_data}).enter().append("rect").attr("x",function(t){return g(t,z)}).attr("width",function(t){return h(t,z)}).attr("y",l.lineSpacing).attr("height",l.graph.height).attr("transform",function(t){return m(t,z)}).attr("rx",function(t){return u()}).attr("ry",function(t){return u()}).attr("class",function(t){if(!l.custom_categories)return 1===t[1]?"rect_has_data":"rect_has_no_data";var a=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];return a&&a.categories?(n.select(this).attr("fill",a.categories[t[1]].color),""):void 0}).on("mouseover",function(t,a){var r=this.getScreenCTM().translate(+this.getAttribute("x"),+this.getAttribute("y"));c.transition().duration(200).style("opacity",.9),c.html(function(){var r="";if(r=l.custom_categories?"&nbsp;"+t[1]+"&nbsp;":1===t[1]?'<i class=" '+l.icon.class_has_data+' tooltip_has_data"></i>':'<i class=" '+l.icon.class_has_no_data+' tooltip_has_no_data"></i>',l.tooltip.description){var i=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];i&&i.description&&i.description[a]&&(r+=" "+i.description[a]+" ")}return l.isDateOnlyFormat?t[2]>n.timeSecond.offset(t[0],86400)?r+o(t[0]).format("l")+" - "+o(t[2]).format("l"):r+o(t[0]).format("l"):t[2]>n.timeSecond.offset(t[0],86400)?r+o(t[0]).format("l")+" "+o(t[0]).format("LTS")+" - "+o(t[2]).format("l")+" "+o(t[2]).format("LTS"):r+o(t[0]).format("LTS")+" - "+o(t[2]).format("LTS")}).style("left",function(){return document.body.clientWidth<n.event.pageX+c.property("offsetWidth"+l.tooltip.left_spacing)?n.event.pageX-c.property("offsetWidth")-l.tooltip.left_spacing+"px":n.event.pageX+l.tooltip.left_spacing+"px"}),"top"===l.tooltip.position&&(c.style("top",function(){return window.pageYOffset+r.f-l.tooltip.height+"px"}).style("height",l.graph.height+l.tooltip.height+"px"),y+l.margin.right<n.event.pageX+c.property("offsetWidth")?c.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):c.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===l.tooltip.position&&c.style("top",n.event.pageY+"px")}).on("mouseout",function(){c.transition().duration(500).style("opacity",0)}).on("click",function(t,e){l.onclickblock.call(this,t,e)}).on("mousemove",function(){c.style("left",function(){return document.body.clientWidth<n.event.pageX+c.property("offsetWidth")+l.tooltip.left_spacing?n.event.pageX-c.property("offsetWidth")-l.tooltip.left_spacing+"px":n.event.pageX+l.tooltip.left_spacing+"px"}),"top"===l.tooltip.position&&(document.body.clientWidth<n.event.pageX+c.property("offsetWidth")?c.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):c.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===l.tooltip.position&&c.style("top",n.event.pageY+"px")}),d(z),l.title.enabled&&E.select("#g_title").append("text").attr("x",l.paddingLeft).attr("y",l.paddingTopHeading).text(l.title.text).attr("class","heading"),l.sub_title.enabled){var B="";x&&(B=l.isDateOnlyFormat?l.sub_title.from_text+" "+o(T).format("MMMM Y")+" "+l.sub_title.to_text+" "+o(k).format("MMMM Y"):l.sub_title.from_text+" "+o(T).format("l")+" "+o(T).format("LTS")+" "+l.sub_title.to_text+" "+o(k).format("l")+" "+o(k).format("LTS")),E.select("#g_title").append("text").attr("x",l.paddingLeft).attr("y",l.paddingTopHeading+17).text(B).attr("class","subheading")}if(!l.custom_categories&&l.legend.enabled){var A=E.select("#g_title").append("g").attr("id","g_legend").attr("transform","translate(0,-12)");A.append("rect").attr("x",y+l.margin.right-150).attr("y",l.paddingTopHeading).attr("height",15).attr("width",15).attr("class","rect_has_data"),A.append("text").attr("x",y+l.margin.right-150+20).attr("y",l.paddingTopHeading+8.5).text(l.legend.has_data_text).attr("class","legend"),A.append("rect").attr("x",y+l.margin.right-150).attr("y",l.paddingTopHeading+17).attr("height",15).attr("width",15).attr("class","rect_has_no_data"),A.append("text").attr("x",y+l.margin.right-150+20).attr("y",l.paddingTopHeading+8.5+15+2).text(l.legend.has_no_data_text).attr("class","legend")}l.scale&&E.call(l.zoomed.transform,n.zoomIdentity.translate(l.scale.x,l.scale.x).scale(l.scale.k))})}var n=window.d3?window.d3:"undefined"!=typeof require?require("d3"):void 0,o=window.moment?window.moment:"undefined"!=typeof require?require("moment"):void 0;if(!n)throw new Error("Require D3.js before visavail script");if(!o)throw new Error("Require moment before visavail script");var l={id:"",id_div_container:"visavail_container",id_div_graph:"example",margin:{top:65,right:40,bottom:20,left:100},width:960,reduce_space_wrap:35,lineSpacing:14,paddingTopHeading:-50,paddingBottom:10,paddingLeft:-100,emphasizeYearTicks:!0,emphasizeMonthTicks:!0,maxDisplayDatasets:0,curDisplayFirstDataset:0,display_date_range:[0,0],custom_categories:!1,isDateOnlyFormat:!0,tooltip:{class:"tooltip",height:11,position:"top",left_spacing:0},legend:{enabled:!0,has_no_data_text:"No Data available",has_data_text:"Data available"},title:{enabled:!0,text:"Data Availability Plot"},sub_title:{enabled:!0,from_text:"from",to_text:"to"},ytitle:!0,icon:{class_has_data:"fas fa-fw fa-check",class_has_no_data:"fas fa-fw fa-times"},date_in_utc:!0,customTimeFormat:{formatMillisecond:".%L",formatSecond:":%S",formatMinute:"%H:%M",formatHour:"%H",formatDay:"%a %d",formatWeek:"%b %d",formatMonth:"%B",formatYear:"%Y"},zoom:{enabled:!1,onzoom:function(){},onzoomstart:function(){},onzoomend:function(){}},onclickblock:function(){},definedBlocks:!1,graph:{type:"bar",width:20,height:18},responsive:{enabled:!1,onresize:function(){}}};if(null!=t)for(var s in t)if(l.hasOwnProperty(s))if("object"==typeof l[s])for(var d in t[s])l[s].hasOwnProperty(d)&&(l[s][d]=t[s][d]);else l[s]=t[s];t.hasOwnProperty("width")||(l.width=document.getElementById(l.id_div_container).offsetWidth),l.id="visavail-"+Math.random().toString(36).substring(7);var c=n.select("body").append("div").attr("class","visavail-tooltip "+l.id).attr("id",l.id).append("div").attr("class",l.tooltip.class+"-"+l.tooltip.position).style("opacity",0);return l.locale={dateTime:r(o().creationData().locale._longDateFormat.LLLL),date:r(o().creationData().locale._longDateFormat.L),time:r(o().creationData().locale._longDateFormat.LTS),periods:["AM","PM"],days:o.weekdays(),shortDays:o.weekdaysShort(),months:o.months(),shortMonths:o.monthsShort()},i.width=function(t){return arguments.length?(l.width=t,i):l.width},i.drawTitle=function(t){return arguments.length?(l.title.enabled=t,i):l.title.enabled},i.maxDisplayDatasets=function(t){return arguments.length?(l.maxDisplayDatasets=t,i):l.maxDisplayDatasets},i.curDisplayFirstDataset=function(t){return arguments.length?(l.curDisplayFirstDataset=t,i):l.curDisplayFirstDataset},i.emphasizeYearTicks=function(t){return arguments.length?(l.emphasizeYearTicks=t,i):l.emphasizeYearTicks},i.displayDateRange=function(t){return arguments.length?(l.display_date_range=t,document.getElementById(l.id_div_graph)?i.updateGraph():i):l.display_date_range},i.resizeWidth=function(t){return l.width=t,i.updateGraph()},i.updateGraph=function(t){if(document.getElementById(l.id_div_graph)&&""!=document.getElementById(l.id_div_graph).innerHTML){if(document.getElementById(l.id_div_graph).innerHTML="",t)return i.createGraph(t);n.select("#"+l.id_div_graph).call(i)}return i},i.createGraph=function(t){return n.select("#"+l.id_div_graph).datum(t).call(i),i},i.destroy=function(t){return document.getElementById(l.id_div_graph)&&(document.getElementById(l.id_div_graph).innerHTML=""),document.getElementById(l.id)&&document.getElementById(l.id).remove(),Object.keys(l).forEach(function(t){l[t]=null}),null},l.responsive.function=function(){l.id_div_container&&document.getElementById(l.id_div_graph)&&""!=document.getElementById(l.id_div_graph).innerHTML&&i.resizeWidth(document.getElementById(l.id_div_container).offsetWidth)},l.responsive.enabled&&window.addEventListener("resize",l.responsive.function),i.createGraph(e),i}var e={};return e.generate=function(e,a){return new t(e,a)},e});