!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.visavail=e()}(this,function(){"use strict";var t={};function e(t,e){var a,i=window.d3?window.d3:"undefined"!=typeof require?require("d3"):void 0,n=window.moment?window.moment:"undefined"!=typeof require?require("moment"):void 0;if(!i)throw new Error("Require D3.js before visavail script");if(!n)throw new Error("Require moment before visavail script");var r=function(t){if(t.constructor===Object){const e=[];return Object.keys(t).forEach(function(a){e.push({measure:a,data:t[a]})}),e}if(Array.isArray(t))return t;throw new Error("Dataset must be array or object")};e=r(e);var o={id:"",id_div_container:"visavail_container",id_div_graph:"example",margin:{top:65,right:60,bottom:20,left:100},width:960,moment_locale:window.navigator.userLanguage||window.navigator.language,reduce_space_wrap:35,line_spacing:35,padding:{top:-49,bottom:0,right:60,left:-100},emphasize_year_ticks:!0,emphasize_month_ticks:!0,ticks_for_graph:6,max_display_datasets:0,cur_display_first_dataset:0,display_date_range:["",""],custom_categories:!1,categories:{},is_date_only_format:!0,date_in_utc:!1,date_is_descending:!1,show_y_title:!0,y_title_some_unavailability_class:"some_unavailability",y_title_total_unavailability_class:"total_unavailability",y_title_total_availability_class:"total_availability",y_percentage:{enabled:!1,some_unavailability_class:"some_unavailability",total_unavailability_class:"total_unavailability",total_availability_class:"total_availability",percentageFormat:i.format(".2%"),unavailability_percentage:!1,custom_percentage:!1},defined_blocks:!1,y_title_tooltip:{enabled:!1,class:"y-tooltip",type:"right",spacing:{left:15,right:15,top:15,bottom:10},fixed:!1,duration:150},tooltip:{class:"tooltip",date_format:"",height:11,position:"top",left_spacing:0,date_plus_time:!1,only_first_date:!1,duration:150,hover_zoom:{enabled:!1,ratio:.4},date_as_utc:!1},legend:{enabled:!0,line_space:12,rect_width:15,offset:5,x_right_offset:150,has_no_data_text:"No Data available",has_data_text:"Data available",categories:[]},title:{enabled:!0,text:"Data Availability Plot",line_spacing:16},sub_title:{enabled:!0,from_text:"from",to_text:"to",line_spacing:16},sub_chart:{enabled:!1,height:0,animation:!0,margin:{top:20,bottom:0},graph:{enabled:!0,width:7,height:7,line_spacing:7}},icon:{class_has_data:"fas fa-fw fa-check",class_has_no_data:"fas fa-fw fa-times"},zoom:{enabled:!1,onZoom:function(){},onZoomStart:function(){},onZoomEnd:function(){}},onClickBlock:function(){},graph:{type:"bar",width:18,height:18,hover_zoom:5,margin:{top:0,left:0}},responsive:{enabled:!1,onresize:function(){}},fill_gaps:{enabled:!1,category:"0"},custom_time_format:{format_millisecond:".%L",format_second:":%S",format_minute:"%H:%M",format_hour:"%H",format_day:"%a %d",format_week:"%b %d",format_month:"%B",format_year:"%Y"}};function s(t){var e={ddd:"a",dddd:"A",MMM:"b",MMMM:"B",lll:"c",DD:"d",D:"e","YYYY-MM-DD":"F",HH:"H",H:"H",hh:"I",h:"I",DDDD:"j",DDD:"-j",MM:"m",M:"-m",mm:"M",m:"-M",A:"p",a:"P",ss:"S",s:"-S",E:"u",d:"w",WW:"W",ll:"x",LTS:"X",YY:"y",YYYY:"Y",ZZ:"z",z:"Z",SSS:"L","%":"%"};return t.split(/( |\/|:|,|\]|\[|\.)/).map(function(t){return":"==t[0]||"/"==t[0]||" "==t[0]||","==t[0]?t:"["!=t[0]&&"]"!=t[0]?e.hasOwnProperty(t)?"%"+e[t]:t.length>0?"["+t+"]":t:void 0}).join("")}function l(t,e){Object.keys(e).forEach(function(a){a in t&&("object"!=typeof t[a]||Array.isArray(t[a])||"categories"==a?typeof e[a]==typeof t[a]&&(t[a]=e[a]):l(t[a],e[a]))})}o.legend.categories.push({class:"rect_has_no_data",text:o.legend.has_no_data_text},{class:"rect_has_data",text:o.legend.has_data_text}),l(o,t),n.locale(o.moment_locale);var c=n().creationData().locale._longDateFormat;if(o.locale={dateTime:s(c.LLLL),date:s(c.L),time:s(c.LTS),periods:["AM","PM"],days:n.weekdays(),shortDays:n.weekdaysShort(),months:n.months(),shortMonths:n.monthsShort()},o.legend.enabled){var d={};for(const t of o.legend.categories)d[t.class]=!0}function p(t){return(i.timeSecond(t)<t?i.timeFormat(o.custom_time_format.format_millisecond):i.timeMinute(t)<t?i.timeFormat(o.custom_time_format.format_second):i.timeHour(t)<t?i.timeFormat(o.custom_time_format.format_minute):i.timeDay(t)<t?i.timeFormat(o.custom_time_format.format_hour):i.timeMonth(t)<t?i.timeWeek(t)<t?i.timeFormat(o.custom_time_format.format_day):i.timeFormat(o.custom_time_format.format_week):i.timeYear(t)<t?i.timeFormat(o.custom_time_format.format_month):i.timeFormat(o.custom_time_format.format_year))(t)}function _(t){t.each(function(e){i.timeFormatDefaultLocale(o.locale);var r=i.select("#"+o.id_div_container).append("div").attr("class","visavail-tooltip "+o.id).attr("id",o.id).append("div").attr("class",o.tooltip.class+"-"+o.tooltip.position).style("opacity",0),s=i.select("#"+o.id_div_container).append("div").attr("class","visavail-ytitle-tooltip "+o.id).attr("id",o.id).append("div").attr("class",o.y_title_tooltip.class).style("opacity",0),l=o.width-o.margin.left-o.margin.right;o.oldwidth||(o.oldwidth=l);var c,_,g=0;0!==o.max_display_datasets?(c=o.cur_display_first_dataset,_=o.cur_display_first_dataset+o.max_display_datasets>e.length?e.length:o.cur_display_first_dataset+o.max_display_datasets,g=Math.ceil(e.length/o.max_display_datasets)):(c=0,_=e.length),t.attr("data-max-pages",g);var u=_-c,h=o.graph.height*u+o.line_spacing*u-1+o.graph.margin.top;let m=!1;for(let t=0;t<e.length;t++)for(let a=0;a<e[t].data.length;a++)if(Array.isArray(e[t].data[a])){if(m||(console.warn("Deprecation warning: data is not formatted as an object"),m=!0),e[t].data[a].length<2)throw new Error("Data-point array must contain at least 2 values");2===e[t].data[a].length?e[t].data[a]={startDate:e[t].data[a][0],state:e[t].data[a][1]}:e[t].data[a]={startDate:e[t].data[a][0],state:e[t].data[a][1],endDate:e[t].data[a][2]}}o.fill_gaps.enabled&&0!=o.fill_gaps.category&&1!=o.fill_gaps.category&&(o.custom_categories=!0);for(var f=0;f<e.length;f++)if(e[f].description&&(o.tooltip.description=!0),null!=e[f].data[0]&&"endDate"in e[f].data[0]){o.defined_blocks=!0,o.custom_categories||Number.isInteger(e[f].data[0].state)||(o.custom_categories=!0);break}var y=i.timeParse("%Y-%m-%d"),v=i.utcParse("%Y-%m-%d %H:%M:%S"),b=i.utcParse("%Y-%m-%d");if(o.date_in_utc)var x=function(t){return b(t)},D=function(t){return v(t)};else x=function(t){return y(t)},D=function(t){return new Date(t)};var w=function(t){if(t instanceof Date)return t;if(Number.isInteger(t))return new Date(t);if(k.test(t))return D(t);if(E.test(t))return x(t);throw new Error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.")},E=new RegExp(/^\d{4}-\d{2}-\d{2}$/),k=new RegExp(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/);performance.now();e.forEach(function(t){t.data.forEach(function(e){if(e.startDate=w(e.startDate),!(e.endDate instanceof Date))if(o.defined_blocks){if(!e.endDate)throw new Error("Defined block true but dataset not correct");e.endDate=w(e.endDate)}else e.endDate=i.timeSecond.offset(e.startDate,t.interval_s)})});var S=n().year(2999).toDate(),M=n().year(0).toDate();e.forEach(function(t,a){var i=[],n=t.data.length;t.data.forEach(function(t,e){t.endDate>=M&&(M=t.endDate),t.startDate<=S&&(S=t.startDate),0!==e&&e<n?t.state===i[i.length-1].state&&t.tooltip_html===i[i.length-1].tooltip_html?o.defined_blocks?i[i.length-1].endDate.getTime()>=t.startDate.getTime()?i[i.length-1].endDate=t.endDate:i.push(t):o.fill_gaps.enabled?i[i.length-1].endDate.getTime()>=t.startDate.getTime()?i[i.length-1].endDate=t.endDate:(i.push({startDate:i[i.length-1].endDate,endDate:t.startDate,state:o.fill_gaps.category}),i.push(t)):i[i.length-1].endDate=t.endDate:(o.defined_blocks?i[i.length-1].endDate.getTime()>t.startDate.getTime()&&(i[i.length-1].endDate=t.startDate):o.fill_gaps.enabled&&i[i.length-1].endDate.getTime()<t.startDate.getTime()?i.push({startDate:i[i.length-1].endDate,endDate:t.startDate,state:o.fill_gaps.category}):i[i.length-1].endDate=t.startDate,i.push(t)):0===e&&(t.length<3&&(t.endDate=t.startDate),i.push(t))}),e[a].disp_data=i}),o.display_date_range&&(o.display_date_range[0]||o.display_date_range[1])&&(o.display_date_range[0]&&(o.display_date_range[0]instanceof Date?S=o.date_in_utc?n.utc(o.display_date_range[0]).toDate():o.display_date_range[0]:(o.display_date_range[0]=w(o.display_date_range[0]),S=o.display_date_range[0])),o.display_date_range[1]&&(o.display_date_range[1]instanceof Date?M=o.date_in_utc?n.utc(o.display_date_range[1]).toDate():o.display_date_range[1]:(o.display_date_range[1]=w(o.display_date_range[1]),M=o.display_date_range[1]))),o.y_percentage.enabled&&!o.y_percentage.custom_percentage&&e.forEach(function(t,a){e[a].timeup_ms=0,e[a].timedown_ms=0,o.custom_categories?t.disp_data.forEach(function(i){i.state===t.category_percentage?e[a].timeup_ms+=i.endDate.getTime()-i.startDate.getTime():e[a].timedown_ms+=i.endDate.getTime()-i.startDate.getTime()}):t.disp_data.forEach(function(t){t.state?e[a].timeup_ms+=t.endDate.getTime()-t.startDate.getTime():e[a].timedown_ms+=t.endDate.getTime()-t.startDate.getTime()})});var z=i.scaleTime().domain([S,M]).range([0,l]),A=i.scaleTime().domain([S,M]).range([0,l]);o.date_is_descending&&(z.domain([M,S]),A.domain([M,S])),o.xScale=z;var T=i.axisTop(o.xScale).scale(o.xScale).ticks(o.ticks_for_graph).tickFormat(p),Y=i.axisBottom(A).scale(A).ticks(o.ticks_for_graph).tickFormat(p),L=i.select(this).append("svg").attr("width",l+o.margin.left+o.margin.right).attr("height",h+o.margin.top+o.margin.bottom+o.sub_chart.height+o.sub_chart.margin.top+o.sub_chart.margin.bottom).append("g").attr("transform","translate("+o.margin.left+","+o.margin.top+")");L.append("g").attr("id","g_title");const I=L.append("g").attr("id","g_graph").attr("transform","translate("+o.graph.margin.left+","+o.graph.margin.top+")");function B(){for(var t=i.select(this),e=t.node().getComputedTextLength(),a=t.text();e>-1*o.padding.left+o.reduce_space_wrap&&a.length>0;)a=a.slice(0,-1),t.text(a+"..."),e=t.node().getComputedTextLength()}if(I.append("g").attr("id","g_axis"),I.append("g").attr("id","g_data").append("rect").attr("id","zoom").attr("width",l).attr("height",h).attr("fill-opacity",0).attr("x",0).attr("y",0),I.append("g").attr("id","g_axis_text"),I.append("g").attr("id","g_title"),o.zoomed=i.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[l,o.height]]).extent([[0,0],[l,o.height]]).on("start",function(){var t=i.event;t.sourceEvent&&"brush"===t.sourceEvent.type||(t.sourceEvent&&"touchstart"===t.sourceEvent.type&&t.sourceEvent.cancelable&&(event.preventDefault(),event.stopImmediatePropagation()),(t.transform.k||t.transform.x)&&(a=t,o.zoom.onZoomStart.call(this,t)))}).on("zoom",function(){var t=i.event;if(t.sourceEvent&&"brush"===t.sourceEvent.type&&!o.sub_chart.animation)return;if(t&&"zoom"!==t.type)return;(t.transform.k||t.transform.x)&&(o.xScale=t.transform.rescaleX(z),t.sourceEvent&&"touchmove"==t.sourceEvent?j(t.sourceEvent.touches[0].layerX,t.sourceEvent.touches[0].layerY):t.sourceEvent&&j(t.sourceEvent.layerX,t.sourceEvent.layerY),G.selectAll("rect").attr("x",function(t){return J(t,o.graph.width,o.xScale,0)}).attr("width",function(t){return K(t,o.graph.width,o.xScale,0)}).attr("transform",function(t){return Q(t,o.xScale,o.graph.height,o.line_spacing,0)}),L.select(".xAxis").call(T.scale(o.xScale)),L.select("#vGrid").selectAll("line").remove(),W(o.xScale),$(o.xScale),o.sub_chart.enabled&&L.select("#g_brush").call(q.move,o.xScale.range().map(t.transform.invertX,t.transform)),o.zoom.onZoom.call(this,o.xScale.domain()))}).on("end",function(){var t=i.event;null!=t&&(t.sourceEvent&&"brush"===t.sourceEvent.type||(t.sourceEvent&&"touchend"===t.sourceEvent.type&&t.sourceEvent.cancelable&&(event.preventDefault(),event.stopImmediatePropagation()),t.transform.k||t.transform.x?(o.scale=i.zoomTransform(L.select("#g_data").node()),o.zoom.onZoomEnd.call(this,o.xScale.domain())):(t.transform.k=a.transform.k,t.transform.x=a.transform.x,o.scale=i.zoomIdentity.translate(t.transform.x,t.transform.y).scale(t.transform.k),o.zoom.onZoomEnd.call(this,o.xScale.domain()))))}),o.zoom.enabled&&L.select("#g_data").call(o.zoomed).attr("cursor","ew-resize"),o.show_y_title){var H=L.select("#g_axis_text").append("g").attr("id","yAxis");if(H.selectAll("text").data(e.slice(c,_)).enter().append("g").attr("id",function(t,e){return e}),H.selectAll("g").append("text").attr("x",o.padding.left).attr("y",function(t,e){return(o.line_spacing+o.graph.height)*e+o.line_spacing+o.graph.height/2}).attr("dy","0.5ex").text(function(t){return t.measure||t.measure_html}).each(B).attr("class",function(t){var e="ytitle";return null!=t.measure_url&&(e+=" link"),o.y_percentage.enabled&&!o.y_percentage.custom_percentage&&(0==t.timedown_ms?e+=" "+o.y_title_total_availability_class:0==t.timeup_ms?e+=" "+o.y_title_total_unavailability_class:e+=" "+o.y_title_some_unavailability_class),e}).on("click",function(t){return null!=t.measure_url?window.open(t.measure_url):null}),H.selectAll("g").append("circle").attr("class",function(t){return"ytitle_icon_background "+((t.icon||"").background_class||"")}).attr("cx",function(t){return t.icon&&t.icon.width?o.padding.left-t.icon.width/2-((t.icon.padding||0).right||0)-(t.icon.padding_right||0):0}).attr("cy",function(t,e){return t.icon&&t.icon.height?(o.line_spacing+o.graph.height)*e+o.line_spacing+o.graph.height/2:0}).attr("r",function(t){return t.icon&&t.icon.width?t.icon.width/2:0}),H.selectAll("g").append("image").attr("class",function(t){return"ytitle_icon_image "+((t.icon||"").image_class||"")}).attr("xlink:href",function(t){return t.icon&&t.icon.url?t.icon.url:""}).attr("x",function(t){return t.icon&&t.icon.width?o.padding.left-t.icon.width-((t.icon.padding||0).right||0)-(t.icon.padding_right||0):0}).attr("y",function(t,e){return t.icon&&t.icon.height?(o.line_spacing+o.graph.height)*e-t.icon.height/2+o.line_spacing+o.graph.height/2:0}).attr("width",function(t){return t.icon&&t.icon.width?t.icon.width:0}).attr("height",function(t){return t.icon&&t.icon.height?t.icon.height:0}),o.y_title_tooltip.enabled){function F(t,e,a,n){if(o.y_title_tooltip.enabled){var r=t.getCTM().translate(t.getAttribute("x"),t.getAttribute("y"));s.transition().duration(o.y_title_tooltip.duration).style("opacity",1),s.html(function(){return a.measure_description||""}),"right"==o.y_title_tooltip.type&&s.style("left",function(){return o.y_title_tooltip.fixed?-1*o.padding.left+"px":o.y_title_tooltip.spacing.right+i.select(t).node().getComputedTextLength()+"px"}).classed(o.y_title_tooltip.type,!0).style("top",r.f-(document.getElementsByClassName(o.y_title_tooltip.class)[0].offsetHeight+(o.line_spacing+o.graph.height)*n)/2+"px"),"top"==o.y_title_tooltip.type&&s.style("left","0px").style("top",r.f-(document.getElementsByClassName(o.y_title_tooltip.class)[0].offsetHeight+o.y_title_tooltip.spacing.top)+"px").classed(o.y_title_tooltip.type,!0),"bottom"==o.y_title_tooltip.type&&s.style("left","0px").style("top",r.f+o.y_title_tooltip.spacing.bottom+"px").classed(o.y_title_tooltip.type,!0)}}function N(){s.transition().duration(o.y_title_tooltip.duration).style("opacity",0)}H.selectAll("g").selectAll("text").on("mouseover",function(t,a){F(this,e,t,a)}).on("touchstart",function(t,e){F(this,t,e)}).on("mouseout",function(){N()}).on("touchleave",function(){N()}).on("touchcancel",function(){N()})}else H.selectAll("g").append("title").text(function(t){return t.measure_description||t.measure})}if(o.y_percentage.enabled){var O=L.select("#g_axis_text").append("g").attr("id","yPercentage");O.selectAll("text").data(e.slice(c,_)).enter().append("g").attr("id",function(t,e){return e}),O.selectAll("g").append("text").attr("x",l).attr("dx",o.padding.right).attr("y",function(t,e){return(o.line_spacing+o.graph.height)*e+o.line_spacing+o.graph.height/2}).attr("dy","0.5ex").attr("text-anchor","end").text(function(t){return!o.custom_categories&&o.y_percentage.unavailability_percentage?o.y_percentage.percentageFormat(t.timedown_ms/(t.timedown_ms+t.timeup_ms)):o.y_percentage.custom_percentage?(t.percentage||"").measure||"":o.y_percentage.percentageFormat(t.timeup_ms/(t.timeup_ms+t.timedown_ms))}).each(B).attr("class",function(t){var e="ypercentage";return o.y_percentage.custom_percentage?o.y_percentage.custom_percentage&&(e+=" "+(t.percentage||"").class||""):0==t.timedown_ms?e+=" "+o.y_percentage.total_availability_class:0==t.timeup_ms?e+=" "+o.y_percentage.total_unavailability_class:e+=" "+o.y_percentage.some_unavailability_class,e})}function W(t){L.select("#vGrid").selectAll("line.vert_grid").data(t.ticks(o.ticks_for_graph)).enter().append("line").attr("x1",function(e){return t(e)}).attr("x2",function(e){return t(e)}).attr("y1",0).attr("y2",o.graph.height*u+o.line_spacing*u-1+o.margin.bottom).attr("class","vert_grid")}L.select("#g_axis").append("g").attr("id","vGrid"),u&&W(o.xScale),L.select("#g_axis").append("g").attr("id","hGrid").selectAll("line.horz_grid").data(e).enter().append("line").attr("x1",0).attr("x2",l).attr("y1",function(t,e){return(o.line_spacing+o.graph.height)*e+o.line_spacing+o.graph.height/2}).attr("y2",function(t,e){return(o.line_spacing+o.graph.height)*e+o.line_spacing+o.graph.height/2}).attr("class","horz_grid"),u&&L.select("#g_axis").append("g").attr("class","xAxis").call(T);var G=L.select("#g_data").selectAll(".g_data").data(e.slice(c,_)).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(o.line_spacing+o.graph.height)*e+")"}).attr("cursor","pointer").attr("class","dataset");function j(t,e,a){r.style("left",function(){return o.width<t+r.property("offsetWidth")+o.tooltip.left_spacing?t-r.property("offsetWidth")-o.tooltip.left_spacing+"px":t+o.tooltip.left_spacing+"px"}),"top"===o.tooltip.position&&(o.width<t+r.property("offsetWidth")+o.tooltip.left_spacing?r.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):r.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===o.tooltip.position&&(document.getElementById(o.id_div_graph).offsetHeight<e+r.property("offsetHeight")?r.style("top",document.getElementById(o.id_div_graph).offsetHeight-r.property("offsetHeight")+"px"):r.style("top",e+"px"))}function C(t){return+t==+new Date(t.getFullYear(),0,1,0,0,0)}function P(t){return+t==+new Date(t.getFullYear(),t.getMonth(),1,0,0,0)}function $(t){var e=t.ticks(o.ticks_for_graph),a=e.map(C),n=e.map(P);o.emphasize_year_ticks&&!a.every(function(t){return!0===t})&&n.every(function(t){return!0===t})&&(i.selectAll("#"+o.id_div_graph+" g.tick").each(function(t,e){a[e]&&i.select(this).attr("class","tick x_tick_emph")}),i.selectAll("#"+o.id_div_graph+" .vert_grid").each(function(t,e){a[e]&&i.select(this).attr("class","vert_grid vert_grid_emph")})),o.emphasize_month_ticks&&!n.every(function(t){return!0===t})&&(i.selectAll("#"+o.id_div_graph+" g.tick").each(function(t,e){n[e]&&i.select(this).attr("class","tick x_tick_emph")}),i.selectAll("#"+o.id_div_graph+" g.vert_grid").each(function(t,e){n[e]&&i.select(this).attr("class","vert_grid vert_grid_emph")}))}if(G.selectAll("rect").data(function(t){return t.disp_data}).enter().append("rect").attr("x",function(t){return J(t,o.graph.width,o.xScale,0)}).attr("width",function(t){return K(t,o.graph.width,o.xScale,0)}).attr("y",o.line_spacing).attr("height",o.graph.height).attr("transform",function(t){return Q(t,o.xScale,o.graph.height,o.line_spacing,0)}).attr("rx",function(t){return U()}).attr("ry",function(t){return U()}).attr("class",function(t){if(!o.custom_categories)return 1===t.state?"rect_has_data":"rect_has_no_data";var a=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];return a&&a.categories&&t.state in a.categories?a.categories[t.state].class:t.state in o.categories?o.categories[t.state].class:void 0}).on("mouseover",function(t,a){o.legend.enabled&&!d[i.select(this).attr("class")]||function(t,e,a,s,l,c){o.tooltip.hover_zoom.enabled&&i.select(t).transition().duration(o.tooltip.duration).attr("x",function(t){return"rhombus"==o.graph.type||"circle"==o.graph.type?J(t,o.graph.width,o.xScale,o.line_spacing*o.tooltip.hover_zoom.ratio*2):J(t,o.graph.width,o.xScale,0)}).attr("width",function(t){return"rhombus"==o.graph.type||"circle"==o.graph.type?K(t,o.graph.width,o.xScale,o.line_spacing*o.tooltip.hover_zoom.ratio):K(t,o.graph.width,o.xScale,0)}).attr("y",o.line_spacing-o.line_spacing*o.tooltip.hover_zoom.ratio/2).attr("height",o.graph.height+o.line_spacing*o.tooltip.hover_zoom.ratio).attr("transform",function(t){return Q(t,o.xScale,o.graph.height,o.line_spacing,o.line_spacing*o.tooltip.hover_zoom.ratio)});var d=t.getCTM().translate(t.getAttribute("x"),t.getAttribute("y"));r.transition().duration(o.tooltip.duration).style("opacity",1),r.html(function(){var t,a="";let i,r;return a=o.custom_categories?(t=e.filter(function(t){return t.disp_data.indexOf(l)>=0})[0])&&t.categories&&l.state in t.categories?t.categories[l.state].tooltip_html:l.state in o.categories?o.categories[l.state].tooltip_html:"&nbsp;"+l.state+"&nbsp;":1===l.state?'<i class=" '+o.icon.class_has_data+' tooltip_has_data"></i>':'<i class=" '+o.icon.class_has_no_data+' tooltip_has_no_data"></i>',o.tooltip.description&&(t=e.filter(function(t){return t.disp_data.indexOf(l)>=0})[0])&&t.description&&t.description[c]&&(a+=" "+t.description[c]+" "),o.tooltip.date_format?o.tooltip.date_as_utc?(i=n.utc(l.startDate).format(o.tooltip.date_format),r=n.utc(l.endDate).format(o.tooltip.date_format)):(i=n(l.startDate).format(o.tooltip.date_format),r=n(l.endDate).format(o.tooltip.date_format)):o.tooltip.date_plus_time?(i=n(l.startDate).format("l"),r=n(l.endDate).format("l")):(i=`${n(l.startDate).format("l")} ${n(l.startDate).format("LTS")}`,r=`${n(l.endDate).format("l")} ${n(l.endDate).format("LTS")}`),i==r||o.tooltip.only_first_date?o.date_is_descending?a+=r:a+=i:o.date_is_descending?a+=`${r} - ${i}`:a+=`${i} - ${r}`,"tooltip_html"in l&&(a+=" "+l.tooltip_html+" "),a}).style("left",function(){return o.width<a+r.property("offsetWidth")+o.tooltip.left_spacing?a-r.property("offsetWidth")-o.tooltip.left_spacing+"px":a+o.tooltip.left_spacing+"px"}),"top"===o.tooltip.position&&(r.style("top",function(){return o.tooltip.hover_zoom.enabled?window.pageYOffset+d.f-o.tooltip.height-o.tooltip.hover_zoom.ratio*o.line_spacing+"px":d.f-o.tooltip.height+"px"}).style("height",function(){return o.tooltip.hover_zoom.enabled?o.tooltip.hover_zoom.ratio*o.line_spacing+o.graph.height+o.tooltip.height+"px":o.graph.height+o.tooltip.height+"px"}),o.width<a+r.property("offsetWidth")+o.tooltip.left_spacing?r.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):r.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none"));"overlay"===o.tooltip.position&&r.style("top",s+"px")}(this,e,i.event.layerX,i.event.layerY,t,a)}).on("mouseout",function(){!function(t){o.tooltip.hover_zoom.enabled&&i.select(t).transition().duration(o.tooltip.duration).attr("x",function(t){return J(t,o.graph.width,o.xScale,0)}).attr("width",function(t){return K(t,o.graph.width,o.xScale,0)}).attr("y",o.line_spacing).attr("height",o.graph.height).attr("transform",function(t){return Q(t,o.xScale,o.graph.height,o.line_spacing,0)});r.transition().duration(o.tooltip.duration).style("opacity",0)}(this)}).on("click",function(t,e){o.legend.enabled&&!d[i.select(this).attr("class")]||o.onClickBlock.call(this,t,e)}).on("mousemove",function(){o.legend.enabled&&!d[i.select(this).attr("class")]||j(i.event.layerX,i.event.layerY,this)}),$(z),o.title.enabled&&L.select("#g_title").append("text").attr("x",o.padding.left).attr("y",o.padding.top).text(o.title.text).attr("class","heading"),o.sub_title.enabled){var Z="";u&&(Z=o.is_date_only_format?o.sub_title.from_text+" "+n(S).format("MMMM Y")+" "+o.sub_title.to_text+" "+n(M).format("MMMM Y"):o.sub_title.from_text+" "+n(S).format("l")+" "+n(S).format("LTS")+" "+o.sub_title.to_text+" "+n(M).format("l")+" "+n(M).format("LTS")),L.select("#g_title").append("text").attr("x",o.padding.left).attr("y",o.padding.top+o.title.line_spacing).text(Z).attr("class","subheading")}if(o.legend.enabled){console.log(d);var X=L.select("#g_title").append("g").attr("id","g_legend").attr("transform","translate(0,-12)");for(let t=0;t<o.legend.categories.length;++t){const e=o.legend.categories[t];X.append("rect").attr("x",l+o.margin.right-o.legend.x_right_offset).attr("y",o.padding.top+t*(o.legend.rect_width+o.legend.offset)).attr("height",o.legend.rect_width).attr("width",o.legend.rect_width).attr("class",e.class).on("click",function(){const t=i.select(this).attr("class"),e=d[t]?.3:1;d[t]=!d[t],i.selectAll(`.${t}`).style("opacity",e)}),X.append("text").attr("x",l+o.margin.right-o.legend.x_right_offset+4*o.legend.rect_width/3).attr("y",o.padding.top+t*(o.legend.rect_width+o.legend.offset)+3*o.legend.line_space/4).text(e.text).attr("dy","0.5ex").attr("class","legend")}}if(o.sub_chart.enabled){var q=i.brushX().extent([[0,0],[l,o.sub_chart.height]]).on("brush end",function(){if(i.event&&i.event.sourceEvent&&"zoom"===i.event.sourceEvent.type)return;var t=i.event.selection||A.range();L.select("#g_data").call(o.zoomed.transform,i.zoomIdentity.scale(l/(t[1]-t[0])).translate(-t[0],0))});L.append("g").attr("id","g_sub").append("g").attr("class","subchart-xAxis").attr("transform","translate( 0, "+(o.sub_chart.margin.top+o.sub_chart.height+h)+")").call(Y).append("g"),L.selectAll("#g_sub").append("g").attr("id","g_sub_data"),o.sub_chart.graph.enabled&&L.selectAll("#g_sub_data").selectAll(".g_sub_data").data(e.slice(c,_)).enter().append("g").attr("transform",function(t,e){return"translate( 0, "+((o.sub_chart.graph.line_spacing+o.sub_chart.graph.height)*e+o.sub_chart.margin.top+h)+")"}).selectAll("rect").data(function(t){return t.disp_data}).enter().append("rect").attr("x",function(t){return J(t,o.sub_chart.graph.width,A,0)}).attr("width",function(t){return K(t,o.sub_chart.graph.width,A,0)}).attr("y",o.sub_chart.graph.line_spacing).attr("height",o.sub_chart.graph.height).attr("transform",function(t){return Q(t,A,o.sub_chart.graph.height,o.sub_chart.graph.line_spacing,0)}).attr("rx",function(t){return U()}).attr("ry",function(t){return U()}).attr("class",function(t){if(!o.custom_categories)return 1===t.state?"rect_has_data":"rect_has_no_data";var a=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];return a&&a.categories&&t.state in a.categories?a.categories[t.state].class:t.state in o.categories?o.categories[t.state].class:void 0}),L.select("#g_sub").append("g").attr("id","g_brush").attr("class","brush").attr("width",l).attr("transform","translate( 0, "+(o.sub_chart.margin.top+h)+")").call(q)}if(o.legend.enabled)for(const t of o.legend.categories){const e=t.class,a=d[e]?1:.3;i.selectAll(`.${e}`).style("opacity",a)}if(o.scale){var R=(-l*o.scale.k*(-1*o.scale.x/(o.oldwidth*o.scale.k))-o.scale.x)/o.scale.k;L.select("#g_data").call(o.zoomed.transform,o.scale.translate(R,0)),o.oldwidth=l}else o.sub_chart.enabled&&L.select("#g_brush").call(q.move,z.range());function J(t,e,a,i){var n=a(t.startDate)-i;return o.date_is_descending&&(n=a(t.endDate)-i),isNaN(n)||n<=0||n+i>l?0-i/2:"rhombus"==o.graph.type||"circle"==o.graph.type?a(t.startDate)-e/2:n}function K(t,e,a,i){var n=a(t.startDate)-i,r=a(t.endDate)+i;return o.date_is_descending&&(n=a(t.endDate)-i,r=a(t.startDate)+i),isNaN(n)||isNaN(r)||!o.date_is_descending&&r-n<0||r<=0&&n<=0?0:o.date_is_descending&&r-n<0?-1*(r-n):"rhombus"==o.graph.type||"circle"==o.graph.type?n+i<0?0-i:e+i:n<0&&r>0?r>l?l:r-i:r<0&&n>0?n>l?l:n-i:r>l?l-n<0?0:l-n+i:r-n}function Q(t,e,a,i,n){var r=e(t.startDate);return("rhombus"==o.graph.type||"circle"==o.graph.type)&&r>0?"rotate(45 "+r+"  "+(a/2+i-n)+")":("rhombus"==o.graph.type||"circle"==o.graph.type)&&r<=0?"rotate(45 0 "+(a/2+i-n)+")":void 0}function U(){return"circle"==o.graph.type?2e5:0}})}return o.custom_time_format||(o.custom_time_format={format_millisecond:s("SSS"),format_second:s(":ss"),format_minute:s(c.LT),format_hour:s(c.LT.substring(0,1)+(c.LTS.indexOf("a")>-1||c.LTS.indexOf("A")>-1?" "+c.LT.slice(-1):"")),format_day:s("ddd DD"),format_week:s("MMM DD"),format_month:s("MMMM"),format_year:s("YYYY")}),t.hasOwnProperty("width")||(o.width=document.getElementById(o.id_div_graph).offsetWidth),o.id="visavail-"+Math.random().toString(36).substring(7),_.maxDisplayDatasets=function(t){return arguments.length?(o.max_display_datasets=t,_):o.max_display_datasets},_.displayDateRange=function(t,e){return arguments.length?(o.display_date_range=t,document.getElementById(o.id_div_graph)?_.updateGraph(null,e):_):o.display_date_range},_.updateOptions=function(t){return _.updateGraph(t)},_.resizeWidth=function(t){return o.width=t,_.updateGraph()},_.updateGraph=function(e,a){if(document.getElementById(o.id_div_graph)&&""!=document.getElementById(o.id_div_graph).innerHTML){if(document.getElementById(o.id_div_graph).innerHTML="",document.getElementById(o.id)&&function(t){for(var e=document.getElementsByClassName(t);e.length>0;)e[0].parentNode.removeChild(e[0])}(o.id),e&&l(o,t),a)return _.createGraph(a);i.select("#"+o.id_div_graph).call(_)}return _},_.createGraph=function(t){return i.select("#"+o.id_div_graph).datum(t).call(_),_},_.appendData=function(t){t=r(t);for(const a of t){e.find(t=>t.measure===a.measure).data.push(...a.data)}return _.updateGraph(null,e)},_.removeOldData=function(t){for(const a of e){for(;a.data.length>0&&a.data[0].endDate<=t;)a.data.shift();a.data[0].startDate<t&&(a.data[0].startDate=t)}return _.updateGraph(null,e)},_.destroy=function(t){return document.getElementById(o.id_div_graph)&&(document.getElementById(o.id_div_graph).innerHTML=""),document.getElementById(o.id)&&document.getElementById(o.id).remove(),Object.keys(o).forEach(function(t){o[t]=null}),null},o.responsive.function=function(){o.id_div_container&&document.getElementById(o.id_div_graph)&&""!=document.getElementById(o.id_div_graph).innerHTML&&_.resizeWidth(document.getElementById(o.id_div_graph).offsetWidth)},o.responsive.enabled&&window.addEventListener("resize",o.responsive.function),_.createGraph(e),_}return Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Element.prototype.remove=Element.prototype.remove||function(){this.parentNode&&this.parentNode.removeChild(this)},t.generate=function(t,a){return new e(t,a)},t});