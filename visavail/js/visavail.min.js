(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.visavail=e()})(this,function(){function t(t,e){function a(t){return(r.timeSecond(t)<t?r.timeFormat(o.customTimeFormat.formatMillisecond):r.timeMinute(t)<t?r.timeFormat(o.customTimeFormat.formatSecond):r.timeHour(t)<t?r.timeFormat(o.customTimeFormat.formatMinute):r.timeDay(t)<t?r.timeFormat(o.customTimeFormat.formatHour):r.timeMonth(t)<t?r.timeWeek(t)<t?r.timeFormat(o.customTimeFormat.formatDay):r.timeFormat(o.customTimeFormat.formatWeek):r.timeYear(t)<t?r.timeFormat(o.customTimeFormat.formatMonth):r.timeFormat(o.customTimeFormat.formatYear))(t)}function i(t){t.each(function(e){function i(){for(var t=r.select(this),e=t.node().getComputedTextLength(),a=t.text();e>o.margin.left+o.reduce_space_wrap&&a.length>0;)a=a.slice(0,-1),t.text(a+"..."),e=t.node().getComputedTextLength()}function s(t){E.select("#vGrid").selectAll("line.vert_grid").data(t.ticks()).enter().append("line").attr("x1",function(e){return t(e)}).attr("x2",function(e){return t(e)}).attr("y1",0).attr("y2",o.graph.height*x+o.lineSpacing*x-1+o.paddingBottom).attr("class","vert_grid")}function l(t){return+t===+new Date(t.getFullYear(),0,1,0,0,0)}function c(t){return+t===+new Date(t.getFullYear(),t.getMonth(),1,0,0,0)}function p(t){var e=t.ticks(),a=e.map(l),i=e.map(c);o.emphasizeYearTicks&&!a.every(function(t){return t===!0})&&i.every(function(t){return t===!0})&&(r.selectAll("#"+o.id_div_graph+" g.tick").each(function(t,e){a[e]&&r.select(this).attr("class","tick x_tick_emph")}),r.selectAll("#"+o.id_div_graph+" .vert_grid").each(function(t,e){a[e]&&r.select(this).attr("class","vert_grid vert_grid_emph")})),o.emphasizeMonthTicks&&!i.every(function(t){return t===!0})&&(r.selectAll("#"+o.id_div_graph+" g.tick").each(function(t,e){i[e]&&r.select(this).attr("class","tick x_tick_emph")}),r.selectAll("#"+o.id_div_graph+" g.vert_grid").each(function(t,e){i[e]&&r.select(this).attr("class","vert_grid vert_grid_emph")}))}function g(){null==r.event.sourceEvent&&"zoom"!==r.event.type||(r.event.transform.k||r.event.transform.x)&&(o.xScale=r.event.transform.rescaleX(z),null!==r.event.sourceEvent&&"zoom"==r.event.type&&d.style("left",r.event.pageX+"px"),L.selectAll("rect").attr("x",function(t){return h(t,o.xScale)}).attr("width",function(t){return m(t,o.xScale)}).attr("transform",function(t){return u(t,o.xScale)}),E.select(".xAxis").call(F.scale(o.xScale)),E.select("#vGrid").selectAll("line").remove(),s(o.xScale),p(o.xScale),o.zoom.onzoom.call(this,o.xScale.domain()))}function h(t,e){return e(t[0])<0?0:"rhombus"==o.graph.type?e(t[0])-o.graph.width/2:e(t[0])}function m(t,e){return e(t[2])-e(t[0])<0||e(t[2])<0&&e(t[1])<0?0:"rhombus"==o.graph.type?e(t[0])<0?0:o.graph.width:e(t[0])<0&&e(t[2])>0?e(t[2]):e(t[2])<0&&e(t[1])>0?e(t[1]):e(t[2])-e(t[0])}function u(t,e){return"rhombus"==o.graph.type&&e(t[0])>0?"rotate(45 "+e(t[0])+"  "+(o.graph.height/2+o.lineSpacing)+")":"rhombus"==o.graph.type&&e(t[0])<=0?"rotate(45 0 "+(o.graph.height/2+o.lineSpacing)+")":void 0}r.timeFormatDefaultLocale(o.locale);var f,_,y=o.width-o.margin.left-o.margin.right,v=0;0!==o.maxDisplayDatasets?(f=o.curDisplayFirstDataset,_=o.curDisplayFirstDataset+o.maxDisplayDatasets>e.length?e.length:o.curDisplayFirstDataset+o.maxDisplayDatasets,v=Math.ceil(e.length/o.maxDisplayDatasets)):(f=0,_=e.length),t.attr("data-max-pages",v);for(var x=_-f,b=o.graph.height*x+o.lineSpacing*x-1,D=0;D<e.length;D++)if(e[D].description&&(o.tooltip.description=!0),null!=e[D].data[0]&&e[D].data[0].length>=3){o.definedBlocks=!0,Number.isInteger(e[D].data[0][1])&&"rhombus"!=o.graph.type||(o.customCategories=!0);break}var w=r.timeParse("%Y-%m-%d"),S=r.timeParse("%Y-%m-%d %H:%M:%S"),M=new RegExp(/^\d{4}-\d{2}-\d{2}$/),T=new RegExp(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/);e.forEach(function(t){t.data.forEach(function(e){if(console.log(e),!(e[0]instanceof Date)){if(M.test(e[0]))e[0]=w(e[0]);else{if(!T.test(e[0]))throw new Error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.");e[0]=S(e[0]),o.isDateOnlyFormat=!1}o.definedBlocks?M.test(e[2])?e[2]=w(e[2]):T.test(e[2])?e[2]=S(e[2]):(e[2]=e[0],"rhombus"!=o.graph.type&&console.error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.")):e[2]=r.timeSecond.offset(e[0],t.interval_s)}})});var k=n().year(2999),Y=n().year(0);e.forEach(function(t,a){var i=[],r=t.data.length;t.data.forEach(function(t,e){console.log(t[0],t[2]),n(t[2]).isSameOrAfter(Y)&&(Y=t[2]),n(t[0]).isSameOrBefore(k)&&(k=t[0]),0!==e&&e<r?t[1]===i[i.length-1][1]?o.definedBlocks?i[i.length-1][2].getTime()===t[0].getTime()?(i[i.length-1][2]=t[2],i[i.length-1][3]=1):i.push(t):(i[i.length-1][2]=t[2],i[i.length-1][3]=1):(t[3]=0,o.definedBlocks||(i[i.length-1][2]=t[0]),i.push(t)):0===e&&(t[3]=0,i.push(t))}),e[a].disp_data=i}),0!=o.display_date_range[0]&&(k=n(o.display_date_range[0])),0!=o.display_date_range[1]&&(Y=n(o.display_date_range[1])),console.log(k,Y);var z=r.scaleTime().domain([k,Y]).range([0,y]),F=r.axisTop().scale(z).tickFormat(a),E=r.select(this).append("svg").attr("width",y+o.margin.left+o.margin.right).attr("height",b+o.margin.top+o.margin.bottom).append("g").attr("transform","translate("+o.margin.left+","+o.margin.top+")");if(E.append("g").attr("id","g_title"),E.append("g").attr("id","g_axis"),o.zoom.enabled&&(o.zoomed=r.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[y,o.height]]).extent([[0,0],[y,o.height]]).on("zoom",g).on("start",function(){var t=r.event;t&&"brush"===t.type||(startEvent=t,o.zoom.onzoomstart.call(this,t))}).on("end",function(){var t=r.event.sourceEvent;t&&"brush"===t.type||t&&startEvent.clientX===t.clientX&&startEvent.clientY===t.clientY||(o.scale=r.zoomTransform(E.node()),o.zoom.onzoomend.call(this,z.domain()))}),E.append("rect").attr("id","zoom").attr("width",y).attr("height",b).attr("fill-opacity",0).attr("cursor","ew-resize").attr("x",0).attr("y",0),E.call(o.zoomed)),E.append("g").attr("id","g_data"),o.ytitle){var H=E.select("#g_axis").append("g").attr("id","yAxis").selectAll("text").data(e.slice(f,_)).enter();H.append("text").attr("x",o.paddingLeft).attr("y",o.lineSpacing+o.graph.height/2).text(function(t){if(null==t.measure_html)return t.measure}).each(i).attr("transform",function(t,e){return"translate(0,"+(o.lineSpacing+o.graph.height)*e+")"}).attr("class",function(t){var e="ytitle";return null!=t.measure_url&&(e+=" link"),e}).on("click",function(t){return null!=t.measure_url?window.open(t.measure_url):null}),H.append("title").text(function(t){return t.measure}),H.append("foreignObject").attr("x",o.paddingLeft).attr("y",o.lineSpacing).attr("transform",function(t,e){return"translate(0,"+(o.lineSpacing+o.graph.height)*e+")"}).attr("width",-1*o.paddingLeft).attr("height",o.graph.height).attr("class","ytitle").html(function(t){if(null!=t.measure_html)return t.measure_html})}E.select("#g_axis").append("g").attr("id","vGrid"),x&&s(z),E.select("#g_axis").append("g").attr("id","hGrid").selectAll("line.horz_grid").data(e).enter().append("line").attr("x1",0).attr("x2",y).attr("y1",function(t,e){return(o.lineSpacing+o.graph.height)*e+o.lineSpacing+o.graph.height/2}).attr("y2",function(t,e){return(o.lineSpacing+o.graph.height)*e+o.lineSpacing+o.graph.height/2}).attr("class","horz_grid"),x&&E.select("#g_axis").append("g").attr("class","xAxis").call(F);var L=E.select("#g_data").selectAll(".g_data").data(e.slice(f,_)).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(o.lineSpacing+o.graph.height)*e+")"}).attr("cursor","pointer").attr("class","dataset");if(L.selectAll("rect").data(function(t){return t.disp_data}).enter().append("rect").attr("x",function(t){return h(t,z)}).attr("width",function(t){return m(t,z)}).attr("y",o.lineSpacing).attr("height",o.graph.height).attr("transform",function(t){return u(t,z)}).attr("class",function(t){if(!o.customCategories)return 1===t[1]?"rect_has_data":"rect_has_no_data";var a=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];return a&&a.categories?(r.select(this).attr("fill",a.categories[t[1]].color),""):void 0}).on("mouseover",function(t,a){var i=this.getScreenCTM().translate(+this.getAttribute("x"),+this.getAttribute("y"));d.transition().duration(200).style("opacity",.9),d.html(function(){var i="";if(i=o.customCategories?"&nbsp;"+t[1]+"&nbsp;":1===t[1]?'<i class=" '+o.icon.class_has_data+' tooltip_has_data"></i>':'<i class=" '+o.icon.class_has_no_data+' tooltip_has_no_data"></i>',o.tooltip.description){var s=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];s&&s.description&&s.description[a]&&(i+=" "+s.description[a]+" ")}return o.isDateOnlyFormat?t[2]>r.timeSecond.offset(t[0],86400)?i+n(t[0]).format("l")+" - "+n(t[2]).format("l"):i+n(t[0]).format("l"):t[2]>r.timeSecond.offset(t[0],86400)?i+n(t[0]).format("l")+" "+n(t[0]).format("LTS")+" - "+n(t[2]).format("l")+" "+n(t[2]).format("LTS"):i+n(t[0]).format("LTS")+" - "+n(t[2]).format("LTS")}).style("left",function(){return document.body.clientWidth<r.event.pageX+d.property("offsetWidth"+o.tooltip.left_spacing)?r.event.pageX-d.property("offsetWidth")-o.tooltip.left_spacing+"px":r.event.pageX+o.tooltip.left_spacing+"px"}),"top"===o.tooltip.position&&(d.style("top",function(){return window.pageYOffset+i.f-o.tooltip.height+"px"}).style("height",o.graph.height+o.tooltip.height+"px"),y+o.margin.right<r.event.pageX+d.property("offsetWidth")?d.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):d.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===o.tooltip.position&&d.style("top",r.event.pageY+"px")}).on("mouseout",function(){d.transition().duration(500).style("opacity",0)}).on("click",function(t,e){o.onclickblock.call(this,t,e)}).on("mousemove",function(){d.style("left",function(){return document.body.clientWidth<r.event.pageX+d.property("offsetWidth")+o.tooltip.left_spacing?r.event.pageX-d.property("offsetWidth")-o.tooltip.left_spacing+"px":r.event.pageX+o.tooltip.left_spacing+"px"}),"top"===o.tooltip.position&&(document.body.clientWidth<r.event.pageX+d.property("offsetWidth")?d.style("border-right","solid thin rgb(0, 0, 0)").style("border-left","none"):d.style("border-left","solid thin rgb(0, 0, 0)").style("border-right","none")),"overlay"===o.tooltip.position&&d.style("top",r.event.pageY+"px")}),p(z),o.title.enabled&&E.select("#g_title").append("text").attr("x",o.paddingLeft).attr("y",o.paddingTopHeading).text(o.title.text).attr("class","heading"),o.sub_title.enabled){var A="";x&&(A=o.isDateOnlyFormat?o.sub_title.from_text+" "+n(k).format("MMMM Y")+" "+o.sub_title.to_text+" "+n(Y).format("MMMM Y"):o.sub_title.from_text+" "+n(k).format("l")+" "+n(k).format("LTS")+" "+o.sub_title.to_text+" "+n(Y).format("l")+" "+n(Y).format("LTS")),E.select("#g_title").append("text").attr("x",o.paddingLeft).attr("y",o.paddingTopHeading+17).text(A).attr("class","subheading")}if(!o.customCategories&&o.legend.enabled){var B=E.select("#g_title").append("g").attr("id","g_legend").attr("transform","translate(0,-12)");B.append("rect").attr("x",y+o.margin.right-150).attr("y",o.paddingTopHeading).attr("height",15).attr("width",15).attr("class","rect_has_data"),B.append("text").attr("x",y+o.margin.right-150+20).attr("y",o.paddingTopHeading+8.5).text(o.legend.has_data_text).attr("class","legend"),B.append("rect").attr("x",y+o.margin.right-150).attr("y",o.paddingTopHeading+17).attr("height",15).attr("width",15).attr("class","rect_has_no_data"),B.append("text").attr("x",y+o.margin.right-150+20).attr("y",o.paddingTopHeading+8.5+15+2).text(o.legend.has_no_data_text).attr("class","legend")}o.scale&&E.call(o.zoomed.transform,r.zoomIdentity.translate(o.scale.x,o.scale.x).scale(o.scale.k))})}var r=window.d3?window.d3:"undefined"!=typeof require?require("d3"):void 0,n=window.moment?window.moment:"undefined"!=typeof require?require("moment"):void 0;if(!r)throw new Error("Require D3.js before visavail script");if(!n)throw new Error("Require moment before visavail script");var o={id_div_container:"visavail_container",id_div_graph:"example",margin:{top:65,right:40,bottom:20,left:100},width:960,reduce_space_wrap:35,lineSpacing:14,paddingTopHeading:-50,paddingBottom:10,paddingLeft:-100,emphasizeYearTicks:!0,emphasizeMonthTicks:!0,maxDisplayDatasets:0,curDisplayFirstDataset:0,display_date_range:[0,0],customCategories:!1,isDateOnlyFormat:!0,tooltip:{class:"tooltip",height:11,position:"top",left_spacing:0},legend:{enabled:!0,has_no_data_text:"No Data available",has_data_text:"Data available"},title:{enabled:!0,text:"Data Availability Plot"},sub_title:{enabled:!0,from_text:"from",to_text:"to"},ytitle:!0,icon:{class_has_data:"fas fa-fw fa-check",class_has_no_data:"fas fa-fw fa-times"},locale:{dateTime:"%A %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:n.weekdays(),shortDays:n.weekdaysShort(),months:n.months(),shortMonths:n.monthsShort()},customTimeFormat:{formatMillisecond:".%L",formatSecond:":%S",formatMinute:"%H:%M",formatHour:"%H",formatDay:"%a %d",formatWeek:"%b %d",formatMonth:"%B",formatYear:"%Y"},zoom:{enabled:!1,onzoom:function(){},onzoomstart:function(){},onzoomend:function(){}},onclickblock:function(){},definedBlocks:!1,graph:{type:"bar",width:20,height:18},responsive:{enabled:!1,onresize:function(){}}};if(null!=t)for(var s in t)if(o.hasOwnProperty(s))if("object"==typeof o[s])for(var l in t[s])o[s].hasOwnProperty(l)&&(o[s][l]=t[s][l]);else o[s]=t[s];t.hasOwnProperty("width")||(o.width=document.getElementById(o.id_div_container).offsetWidth);var d=r.select("body").append("div").attr("class","visavail-tooltip").append("div").attr("class",o.tooltip.class+"-"+o.tooltip.position).style("opacity",0);return i.width=function(t){return arguments.length?(o.width=t,i):o.width},i.drawTitle=function(t){return arguments.length?(o.title.enabled=t,i):o.title.enabled},i.maxDisplayDatasets=function(t){return arguments.length?(o.maxDisplayDatasets=t,i):o.maxDisplayDatasets},i.curDisplayFirstDataset=function(t){return arguments.length?(o.curDisplayFirstDataset=t,i):o.curDisplayFirstDataset},i.emphasizeYearTicks=function(t){return arguments.length?(o.emphasizeYearTicks=t,i):o.emphasizeYearTicks},i.displayDateRange=function(t){return arguments.length?(o.display_date_range=t,document.getElementById(o.id_div_graph)?i.updateGraph():i):o.display_date_range},i.resizeWidth=function(t){return o.width=t,i.updateGraph()},i.updateGraph=function(t){if(document.getElementById(o.id_div_graph)&&""!=document.getElementById(o.id_div_graph).innerHTML){if(document.getElementById(o.id_div_graph).innerHTML="",t)return i.createGraph(t);r.select("#"+o.id_div_graph).call(i)}return i},i.createGraph=function(t){return r.select("#"+o.id_div_graph).datum(t).call(i),i},i.destroy=function(t){return document.getElementById(o.id_div_graph)&&(document.getElementById(o.id_div_graph).innerHTML=""),Object.keys(o).forEach(function(t){o[t]=null}),null},o.responsive.function=function(){o.id_div_container&&document.getElementById(o.id_div_graph)&&""!=document.getElementById(o.id_div_graph).innerHTML&&i.resizeWidth(document.getElementById(o.id_div_container).offsetWidth)},o.responsive.enabled&&window.addEventListener("resize",o.responsive.function),i.createGraph(e),i}var e={};return e.generate=function(e,a){return new t(e,a)},e});