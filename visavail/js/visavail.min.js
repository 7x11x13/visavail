(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.visavail=e()})(this,function(){function t(t,e){function a(t){return(n.timeSecond(t)<t?n.timeFormat(s.customTimeFormat.formatMillisecond):n.timeMinute(t)<t?n.timeFormat(s.customTimeFormat.formatSecond):n.timeHour(t)<t?n.timeFormat(s.customTimeFormat.formatMinute):n.timeDay(t)<t?n.timeFormat(s.customTimeFormat.formatHour):n.timeMonth(t)<t?n.timeWeek(t)<t?n.timeFormat(s.customTimeFormat.formatDay):n.timeFormat(s.customTimeFormat.formatWeek):n.timeYear(t)<t?n.timeFormat(s.customTimeFormat.formatMonth):n.timeFormat(s.customTimeFormat.formatYear))(t)}function i(t){t.each(function(e){function i(t){k.select("#vGrid").selectAll("line.vert_grid").data(t.ticks()).enter().append("line").attr("x1",function(e){return t(e)}).attr("x2",function(e){return t(e)}).attr("y1",0).attr("y2",s.barHeight*h+s.lineSpacing*h-1+s.paddingBottom).attr("class","vert_grid")}function r(t){return+t===+new Date(t.getFullYear(),0,1,0,0,0)}function l(t){return+t===+new Date(t.getFullYear(),t.getMonth(),1,0,0,0)}function d(t){var e=t.ticks(),a=e.map(r),i=e.map(l);s.emphasizeYearTicks&&!a.every(function(t){return t===!0})&&i.every(function(t){return t===!0})&&(n.selectAll("g.tick").each(function(t,e){a[e]&&n.select(this).attr("class","tick x_tick_emph")}),n.selectAll(".vert_grid").each(function(t,e){a[e]&&n.select(this).attr("class","vert_grid vert_grid_emph")})),s.emphasizeMonthTicks&&!i.every(function(t){return t===!0})&&(n.selectAll("g.tick").each(function(t,e){i[e]&&n.select(this).attr("class","tick x_tick_emph")}),n.selectAll(".vert_grid").each(function(t,e){i[e]&&n.select(this).attr("class","vert_grid vert_grid_emph")}))}function m(){null==n.event.sourceEvent&&"zoom"!==n.event.type||(s.xScale=n.event.transform.rescaleX(M),null!==n.event.sourceEvent&&"zoom"==n.event.type&&c.style("left",n.event.pageX+"px"),H.selectAll("rect").attr("x",function(t){return s.xScale(t[0])<0?0:s.xScale(t[0])}).attr("width",function(t){return s.xScale(t[2])-s.xScale(t[0])<0||s.xScale(t[2])<0&&s.xScale(t[1])<0?0:s.xScale(t[0])<0&&s.xScale(t[2])>0?s.xScale(t[2]):s.xScale(t[2])<0&&s.xScale(t[1])>0?s.xScale(t[1]):s.xScale(t[2])-s.xScale(t[0])}),k.select(".xAxis").call(T.scale(s.xScale)),k.select("#vGrid").selectAll("line").remove(),i(s.xScale),d(s.xScale),s.zoom.onzoom.call(this,s.xScale.domain()))}n.timeFormatDefaultLocale(s.locale);var p,f,u=s.width-s.margin.left-s.margin.right,g=0;0!==s.maxDisplayDatasets?(p=s.curDisplayFirstDataset,f=s.curDisplayFirstDataset+s.maxDisplayDatasets>e.length?e.length:s.curDisplayFirstDataset+s.maxDisplayDatasets,g=Math.ceil(e.length/s.maxDisplayDatasets)):(p=0,f=e.length),t.attr("data-max-pages",g);var h=f-p,_=s.barHeight*h+s.lineSpacing*h-1;s.definedBlocks=!1;for(var x=0;x<e.length;x++){if(e[x].description&&(s.tooltip.description=!0),3===e[x].data[0].length){s.definedBlocks=!0;break}if(s.definedBlocks)throw new Error("Detected different data formats in input data. Format can either be continuous data format or time gap data format but not both.")}var y=n.timeParse("%Y-%m-%d"),v=n.timeParse("%Y-%m-%d %H:%M:%S"),D=new RegExp(/^\d{4}-\d{2}-\d{2}$/),S=new RegExp(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/);e.forEach(function(t){t.data.forEach(function(e){if(!(e[0]instanceof Date)){if(D.test(e[0]))e[0]=y(e[0]);else{if(!S.test(e[0]))throw new Error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.");e[0]=v(e[0]),s.isDateOnlyFormat=!1}if(s.definedBlocks)if(D.test(e[2]))e[2]=y(e[2]);else{if(!S.test(e[2]))throw new Error("Date/time format not recognized. Pick between 'YYYY-MM-DD' or 'YYYY-MM-DD HH:MM:SS'.");e[2]=v(e[2])}else e[2]=n.timeSecond.offset(e[0],t.interval_s)}})}),e.forEach(function(t,a){var i=[],r=t.data.length;t.data.forEach(function(t,e){0!==e&&e<r?t[1]===i[i.length-1][1]?s.definedBlocks?i[i.length-1][2].getTime()===t[0].getTime()?(i[i.length-1][2]=t[2],i[i.length-1][3]=1):i.push(t):(i[i.length-1][2]=t[2],i[i.length-1][3]=1):(t[3]=0,s.definedBlocks||(i[i.length-1][2]=t[0]),i.push(t)):0===e&&(t[3]=0,i.push(t))}),e[a].disp_data=i});var b=s.displayDateRange[0],w=s.displayDateRange[1];if(0!==b&&(b=o(b)),0!==w&&(w=o(w)),0!==s.displayDateRange[0]&&0!==s.displayDateRange[1]||e.forEach(function(t,e){t.disp_data.length>0&&(0===b&&0===w?(b=t.disp_data[0][0],w=t.disp_data[t.disp_data.length-1][2]):(0===s.displayDateRange[0]&&t.disp_data[0][0]<b&&(b=t.disp_data[0][0]),0===s.displayDateRange[1]&&t.disp_data[t.disp_data.length-1][2]>w&&(w=t.disp_data[t.disp_data.length-1][2])))}),s.xScale)var M=s.xScale.range([0,u]);else var M=n.scaleTime().domain([b,w]).range([0,u]);var T=n.axisTop().scale(M).tickFormat(a),k=n.select(this).append("svg").attr("width",u+s.margin.left+s.margin.right).attr("height",_+s.margin.top+s.margin.bottom).append("g").attr("transform","translate("+s.margin.left+","+s.margin.top+")");if(k.append("g").attr("id","g_title"),k.append("g").attr("id","g_axis"),s.zoom.enabled){var Y=n.zoom().on("zoom",m).on("start",function(){var t=n.event;t&&"brush"===t.type||(startEvent=t,s.zoom.onzoomstart.call(this,t))}).on("end",function(){var t=n.event.sourceEvent;t&&"brush"===t.type||t&&startEvent.clientX===t.clientX&&startEvent.clientY===t.clientY||s.zoom.onzoomend.call(this,s.xScale.domain())});k.append("rect").attr("id","zoom").attr("width",u).attr("height",_).attr("fill-opacity",0).attr("cursor","ew-resize").attr("x",0).attr("y",0),k.call(Y)}if(k.append("g").attr("id","g_data"),s.ytitle){var F=k.select("#g_axis").append("g").attr("id","yAxis").selectAll("text").data(e.slice(p,f)).enter();F.append("text").attr("x",s.paddingLeft).attr("y",s.lineSpacing+s.barHeight/2).text(function(t){if(null==t.measure_html)return t.measure}).attr("transform",function(t,e){return"translate(0,"+(s.lineSpacing+s.barHeight)*e+")"}).attr("class",function(t){var e="ytitle";return null!=t.measure_url&&(e+=" link"),e}).on("click",function(t){return null!=t.measure_url?window.open(t.measure_url):null}),F.append("foreignObject").attr("x",s.paddingLeft).attr("y",s.lineSpacing).attr("transform",function(t,e){return"translate(0,"+(s.lineSpacing+s.barHeight)*e+")"}).attr("width",-1*s.paddingLeft).attr("height",s.barHeight).attr("class","ytitle").html(function(t){if(null!=t.measure_html)return t.measure_html})}k.select("#g_axis").append("g").attr("id","vGrid"),h&&i(M),k.select("#g_axis").append("g").attr("id","hGrid").selectAll("line.horz_grid").data(e).enter().append("line").attr("x1",0).attr("x2",u).attr("y1",function(t,e){return(s.lineSpacing+s.barHeight)*e+s.lineSpacing+s.barHeight/2}).attr("y2",function(t,e){return(s.lineSpacing+s.barHeight)*e+s.lineSpacing+s.barHeight/2}).attr("class","horz_grid"),h&&k.select("#g_axis").append("g").attr("class","xAxis").call(T);var H=k.select("#g_data").selectAll(".g_data").data(e.slice(p,f)).enter().append("g").attr("transform",function(t,e){return"translate(0,"+(s.lineSpacing+s.barHeight)*e+")"}).attr("cursor","pointer").attr("class","dataset");if(H.selectAll("rect").data(function(t){return t.disp_data}).enter().append("rect").attr("x",function(t){return M(t[0])<0?0:M(t[0])}).attr("width",function(t){return M(t[2])-M(t[0])<0||M(t[2])<0&&M(t[1])<0?0:M(t[0])<0&&M(t[2])>0?M(t[2]):M(t[2])<0&&M(t[1])>0?M(t[1]):M(t[2])-M(t[0])}).attr("y",s.lineSpacing).attr("height",s.barHeight).attr("class",function(t){if(!s.definedBlocks)return 1===t[1]?"rect_has_data":"rect_has_no_data";var a=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];return a&&a.categories?(n.select(this).attr("fill",a.categories[t[1]].color),""):void 0}).on("mouseover",function(t,a){var i=this.getScreenCTM().translate(+this.getAttribute("x"),+this.getAttribute("y"));c.transition().duration(200).style("opacity",.9),c.html(function(){var i="";if(i=s.definedBlocks?"&nbsp;"+t[1]+"&nbsp;":1===t[1]?'<i class=" '+s.icon.class_has_data+' tooltip_has_data"></i>':'<i class=" '+s.icon.class_has_no_data+' tooltip_has_no_data"></i>',s.tooltip.description){var r=e.filter(function(e){return e.disp_data.indexOf(t)>=0})[0];r&&r.description&&r.description[a]&&(i+=" "+r.description[a]+" ")}return s.isDateOnlyFormat?t[2]>n.timeSecond.offset(t[0],86400)?i+o(t[0]).format("l")+" - "+o(t[2]).format("l"):i+o(t[0]).format("l"):t[2]>n.timeSecond.offset(t[0],86400)?i+o(t[0]).format("l")+" "+o(t[0]).format("LTS")+" - "+o(t[2]).format("l")+" "+o(t[2]).format("LTS"):i+o(t[0]).format("LTS")+" - "+o(t[2]).format("LTS")}).style("left",function(){return n.event.pageX+"px"}).style("top",function(){return window.pageYOffset+i.f-s.tooltip.height+"px"}).style("height",s.barHeight+s.tooltip.height+"px")}).on("mouseout",function(){c.transition().duration(500).style("opacity",0)}).on("mousemove",function(){c.style("left",n.event.pageX+"px")}),d(M),s.title.enabled&&k.select("#g_title").append("text").attr("x",s.paddingLeft).attr("y",s.paddingTopHeading).text(s.title.text).attr("class","heading"),s.sub_title.enabled){var z="";h&&(z=s.isDateOnlyFormat?s.sub_title.from_text+" "+o(b).format("MMMM Y")+" "+s.sub_title.to_text+" "+o(w).format("MMMM Y"):s.sub_title.from_text+" "+o(b).format("l")+" "+o(b).format("LTS")+" "+s.sub_title.to_text+" "+o(w).format("l")+" "+o(w).format("LTS")),k.select("#g_title").append("text").attr("x",s.paddingLeft).attr("y",s.paddingTopHeading+17).text(z).attr("class","subheading")}if(!s.definedBlocks&&s.legend.enabled){var E=k.select("#g_title").append("g").attr("id","g_legend").attr("transform","translate(0,-12)");E.append("rect").attr("x",u+s.margin.right-150).attr("y",s.paddingTopHeading).attr("height",15).attr("width",15).attr("class","rect_has_data"),E.append("text").attr("x",u+s.margin.right-150+20).attr("y",s.paddingTopHeading+8.5).text(s.legend.has_data_text).attr("class","legend"),E.append("rect").attr("x",u+s.margin.right-150).attr("y",s.paddingTopHeading+17).attr("height",15).attr("width",15).attr("class","rect_has_no_data"),E.append("text").attr("x",u+s.margin.right-150+20).attr("y",s.paddingTopHeading+8.5+15+2).text(s.legend.has_no_data_text).attr("class","legend")}})}function r(){i.resizeWidth(s.id_div_graph,document.getElementById(s.id_div_container).offsetWidth)}var n=window.d3?window.d3:"undefined"!=typeof require?require("d3"):void 0,o=window.moment?window.moment:"undefined"!=typeof require?require("moment"):void 0;if(!n)throw new Error("Require D3.js before visavail script");if(!o)throw new Error("Require moment before visavail script");var s={id_div_container:"visavail_container",id_div_graph:"example",margin:{top:70,right:40,bottom:20,left:100},width:940,barHeight:18,lineSpacing:14,paddingTopHeading:-50,paddingBottom:10,paddingLeft:-100,emphasizeYearTicks:!0,emphasizeMonthTicks:!0,maxDisplayDatasets:0,curDisplayFirstDataset:0,displayDateRange:[0,0],customCategories:!1,isDateOnlyFormat:!0,tooltip:{class:"tooltip",height:11},legend:{enabled:!0,has_no_data_text:"No Data available",has_data_text:"Data available"},title:{enabled:!0,text:"Data Availability Plot"},sub_title:{enabled:!0,from_text:"from",to_text:"to"},ytitle:!0,icon:{class_has_data:"fas fa-fw fa-check",class_has_no_data:"fas fa-fw fa-times"},locale:{dateTime:"%A %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:o.weekdays(),shortDays:o.weekdaysShort(),months:o.months(),shortMonths:o.monthsShort()},customTimeFormat:{formatMillisecond:".%L",formatSecond:":%S",formatMinute:"%H:%M",formatHour:"%H",formatDay:"%a %d",formatWeek:"%b %d",formatMonth:"%B",formatYear:"%Y"},zoom:{enabled:!1,onzoom:function(){},onzoomstart:function(){},onzoomend:function(){}},responsive:!0};if(null!=t)for(var l in t)if(s.hasOwnProperty(l))if("object"==typeof s[l])for(var d in t[l])s[l].hasOwnProperty(d)&&(s[l][d]=t[l][d]);else s[l]=t[l];var c=n.select("body").append("div").attr("class",s.tooltip.class).style("opacity",0);return i.width=function(t){return arguments.length?(s.width=t,i):s.width},i.drawTitle=function(t){return arguments.length?(s.title.enabled=t,i):s.title.enabled},i.maxDisplayDatasets=function(t){return arguments.length?(s.maxDisplayDatasets=t,i):s.maxDisplayDatasets},i.curDisplayFirstDataset=function(t){return arguments.length?(s.curDisplayFirstDataset=t,i):s.curDisplayFirstDataset},i.emphasizeYearTicks=function(t){return arguments.length?(s.emphasizeYearTicks=t,i):s.emphasizeYearTicks},i.displayDateRange=function(t,e){return arguments.length?(s.displayDateRange=e,i.updateGraph(t)):s.displayDateRange},i.resizeWidth=function(t,e){return s.width=e,i.updateGraph(t)},i.updateGraph=function(t,e){return document.getElementById(t).innerHTML="",e?createGraph(t,e):(n.select("#"+t).call(i),i)},i.createGraph=function(t,e){return n.select("#"+t).datum(e).call(i),i},s.responsive&&window.addEventListener("resize",r),i.createGraph(s.id_div_graph,e),i}var e={};return e.generate=function(e,a){return new t(e,a)},e});